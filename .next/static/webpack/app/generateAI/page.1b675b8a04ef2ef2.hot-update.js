"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/generateAI/page",{

/***/ "(app-pages-browser)/./src/lib/ai-service.ts":
/*!*******************************!*\
  !*** ./src/lib/ai-service.ts ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   aiService: () => (/* binding */ aiService)\n/* harmony export */ });\n// AI Service - Automatic Configuration with Fallback\nclass AIService {\n    loadConfig() {\n        // Load from environment variables automatically\n        const stabilityKey = \"sk-CHoGTOr0amzOFTw5kFQh0tIDVl5gsrEoJeuu3ENbXr7tnDJM\";\n        const replicateKey = \"r8_H4zWx5r0UAQg6iJmKgNiVbWCa0wNw083qIba4\";\n        const openaiKey = \"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\";\n        // Priority: Stability AI > Replicate > OpenAI > Demo\n        if (stabilityKey) {\n            return {\n                service: 'stability',\n                apiKey: stabilityKey,\n                endpoint: 'https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/image-to-image',\n                isConfigured: true\n            };\n        } else if (replicateKey) {\n            return {\n                service: 'replicate',\n                apiKey: replicateKey,\n                endpoint: 'https://api.replicate.com/v1/predictions',\n                isConfigured: true\n            };\n        } else if (openaiKey) {\n            return {\n                service: 'openai',\n                apiKey: openaiKey,\n                endpoint: 'https://api.openai.com/v1/images/generations',\n                isConfigured: true\n            };\n        }\n        // Fallback to demo mode\n        return {\n            service: 'demo',\n            apiKey: '',\n            endpoint: '',\n            isConfigured: false\n        };\n    }\n    getServiceConfig(service) {\n        switch(service){\n            case 'stability':\n                const stabilityKey = \"sk-CHoGTOr0amzOFTw5kFQh0tIDVl5gsrEoJeuu3ENbXr7tnDJM\";\n                if (stabilityKey) {\n                    return {\n                        service: 'stability',\n                        apiKey: stabilityKey,\n                        endpoint: 'https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/image-to-image',\n                        isConfigured: true\n                    };\n                }\n                break;\n            case 'replicate':\n                const replicateKey = \"r8_H4zWx5r0UAQg6iJmKgNiVbWCa0wNw083qIba4\";\n                if (replicateKey) {\n                    return {\n                        service: 'replicate',\n                        apiKey: replicateKey,\n                        endpoint: 'https://api.replicate.com/v1/predictions',\n                        isConfigured: true\n                    };\n                }\n                break;\n            case 'openai':\n                const openaiKey = \"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\";\n                if (openaiKey) {\n                    return {\n                        service: 'openai',\n                        apiKey: openaiKey,\n                        endpoint: 'https://api.openai.com/v1/images/generations',\n                        isConfigured: true\n                    };\n                }\n                break;\n        }\n        return null;\n    }\n    async generateFoxPerson(imageBlob, prompt, strength) {\n        const errors = [];\n        // Try the current configured service first\n        if (this.config.isConfigured) {\n            try {\n                console.log(\"Trying \".concat(this.config.service, \" service\"));\n                return await this.generateWithService(this.config, imageBlob, prompt, strength);\n            } catch (error) {\n                const errorMessage = error instanceof Error ? error.message : String(error);\n                errors.push(\"\".concat(this.config.service, \": \").concat(errorMessage));\n                console.warn(\"\".concat(this.config.service, \" failed:\"), errorMessage);\n            }\n        }\n        // Try fallback services\n        for (const service of this.fallbackServices){\n            if (service === this.config.service) continue; // Skip already tried service\n            const serviceConfig = this.getServiceConfig(service);\n            if (!serviceConfig) continue;\n            try {\n                console.log(\"Trying fallback \".concat(service, \" service\"));\n                return await this.generateWithService(serviceConfig, imageBlob, prompt, strength);\n            } catch (error) {\n                const errorMessage = error instanceof Error ? error.message : String(error);\n                errors.push(\"\".concat(service, \": \").concat(errorMessage));\n                console.warn(\"\".concat(service, \" failed:\"), errorMessage);\n            }\n        }\n        // All services failed - return demo image\n        console.warn('All AI services failed, returning demo image');\n        return this.getDemoImage();\n    }\n    getDemoImage() {\n        // Return a demo fox person image from public assets\n        const demoImages = [\n            '/fox.png',\n            '/fox2.jpg',\n            '/fox3.jpg',\n            '/fox4.jpg',\n            '/fox5.jpg'\n        ];\n        // Return a random demo image\n        const randomImage = demoImages[Math.floor(Math.random() * demoImages.length)];\n        return randomImage;\n    }\n    async generateWithService(config, imageBlob, prompt, strength) {\n        switch(config.service){\n            case 'stability':\n                return await this.generateWithStability(config, imageBlob, prompt, strength);\n            case 'replicate':\n                return await this.generateWithReplicate(config, imageBlob, prompt, strength);\n            case 'openai':\n                return await this.generateWithOpenAI(config, imageBlob, prompt, strength);\n            default:\n                throw new Error('Unsupported service');\n        }\n    }\n    async generateWithStability(config, imageBlob, prompt, strength) {\n        const formData = new FormData();\n        formData.append('init_image', imageBlob, 'input.jpg');\n        // Include strength in the prompt text\n        const strengthText = strength >= 0.8 ? \"high transformation\" : strength >= 0.5 ? \"medium transformation\" : \"subtle transformation\";\n        const enhancedPrompt = \"Transform this person into a beautiful fox person with \".concat(strengthText, \": \").concat(prompt, \", anthropomorphic fox, detailed orange fur, pointy fox ears, bushy fox tail, human-like body, high quality, detailed, professional photography\");\n        formData.append('text_prompts[0][text]', enhancedPrompt);\n        formData.append('text_prompts[0][weight]', '1');\n        formData.append('text_prompts[1][text]', 'low quality, blurry, distorted, bad anatomy, deformed, ugly, bad proportions');\n        formData.append('text_prompts[1][weight]', '-1');\n        formData.append('cfg_scale', '7.5');\n        formData.append('steps', '30');\n        formData.append('samples', '1');\n        formData.append('style_preset', 'photographic');\n        const response = await fetch(config.endpoint, {\n            method: 'POST',\n            headers: {\n                'Authorization': \"Bearer \".concat(config.apiKey),\n                'Accept': 'application/json'\n            },\n            body: formData\n        });\n        if (!response.ok) {\n            const errorText = await response.text();\n            throw new Error(\"Stability AI failed: \".concat(response.status, \" - \").concat(errorText));\n        }\n        const result = await response.json();\n        if (result.artifacts && result.artifacts.length > 0) {\n            return \"data:image/png;base64,\".concat(result.artifacts[0].base64);\n        } else {\n            throw new Error('No image generated');\n        }\n    }\n    async generateWithReplicate(config, imageBlob, prompt, strength) {\n        // Convert blob to base64\n        const base64 = await this.blobToBase64(imageBlob);\n        const response = await fetch(config.endpoint, {\n            method: 'POST',\n            headers: {\n                'Authorization': \"Token \".concat(config.apiKey),\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                version: \"39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b\",\n                input: {\n                    image: base64,\n                    prompt: \"fox person: \".concat(prompt),\n                    strength: strength\n                }\n            })\n        });\n        if (!response.ok) {\n            throw new Error(\"Replicate failed: \".concat(response.status));\n        }\n        const result = await response.json();\n        return result.output[0]; // Replicate returns image URLs\n    }\n    async generateWithOpenAI(config, imageBlob, prompt, strength) {\n        const response = await fetch(config.endpoint, {\n            method: 'POST',\n            headers: {\n                'Authorization': \"Bearer \".concat(config.apiKey),\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                model: \"dall-e-3\",\n                prompt: \"Transform this person into a fox person with strength \".concat(strength, \": \").concat(prompt),\n                n: 1,\n                size: \"1024x1024\"\n            })\n        });\n        if (!response.ok) {\n            throw new Error(\"OpenAI failed: \".concat(response.status));\n        }\n        const result = await response.json();\n        return result.data[0].url; // OpenAI returns image URLs\n    }\n    blobToBase64(blob) {\n        return new Promise((resolve, reject)=>{\n            const reader = new FileReader();\n            reader.onload = ()=>{\n                const result = reader.result;\n                resolve(result.split(',')[1]); // Remove data:image/...;base64, prefix\n            };\n            reader.onerror = reject;\n            reader.readAsDataURL(blob);\n        });\n    }\n    isConfigured() {\n        return this.config.isConfigured;\n    }\n    getServiceName() {\n        return this.config.service;\n    }\n    constructor(){\n        this.fallbackServices = [\n            'stability',\n            'replicate',\n            'openai',\n            'openrouter'\n        ];\n        this.config = this.loadConfig();\n    }\n}\n// Export singleton instance\nconst aiService = new AIService();\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL3NyYy9saWIvYWktc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEscURBQXFEO0FBUXJELE1BQU1BO0lBUUlDLGFBQThCO1FBQ3BDLGdEQUFnRDtRQUNoRCxNQUFNQyxlQUFlQyxxREFBeUM7UUFDOUQsTUFBTUcsZUFBZUgsMENBQXlDO1FBQzlELE1BQU1LLFlBQVlMLHNLQUFzQztRQUV4RCxxREFBcUQ7UUFDckQsSUFBSUQsY0FBYztZQUNoQixPQUFPO2dCQUNMUSxTQUFTO2dCQUNUQyxRQUFRVDtnQkFDUlUsVUFBVTtnQkFDVkMsY0FBYztZQUNoQjtRQUNGLE9BQU8sSUFBSVAsY0FBYztZQUN2QixPQUFPO2dCQUNMSSxTQUFTO2dCQUNUQyxRQUFRTDtnQkFDUk0sVUFBVTtnQkFDVkMsY0FBYztZQUNoQjtRQUNGLE9BQU8sSUFBSUwsV0FBVztZQUNwQixPQUFPO2dCQUNMRSxTQUFTO2dCQUNUQyxRQUFRSDtnQkFDUkksVUFBVTtnQkFDVkMsY0FBYztZQUNoQjtRQUNGO1FBRUEsd0JBQXdCO1FBQ3hCLE9BQU87WUFDTEgsU0FBUztZQUNUQyxRQUFRO1lBQ1JDLFVBQVU7WUFDVkMsY0FBYztRQUNoQjtJQUNGO0lBRVFDLGlCQUFpQkosT0FBNkMsRUFBMEI7UUFDOUYsT0FBUUE7WUFDTixLQUFLO2dCQUNILE1BQU1SLGVBQWVDLHFEQUF5QztnQkFDOUQsSUFBSUQsY0FBYztvQkFDaEIsT0FBTzt3QkFDTFEsU0FBUzt3QkFDVEMsUUFBUVQ7d0JBQ1JVLFVBQVU7d0JBQ1ZDLGNBQWM7b0JBQ2hCO2dCQUNGO2dCQUNBO1lBQ0YsS0FBSztnQkFDSCxNQUFNUCxlQUFlSCwwQ0FBeUM7Z0JBQzlELElBQUlHLGNBQWM7b0JBQ2hCLE9BQU87d0JBQ0xJLFNBQVM7d0JBQ1RDLFFBQVFMO3dCQUNSTSxVQUFVO3dCQUNWQyxjQUFjO29CQUNoQjtnQkFDRjtnQkFDQTtZQUNGLEtBQUs7Z0JBQ0gsTUFBTUwsWUFBWUwsc0tBQXNDO2dC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TSxrQkFBa0MsT0FBaEJzQixTQUFTUSxNQUFNO1FBQ25EO1FBRUEsTUFBTUMsU0FBUyxNQUFNVCxTQUFTVSxJQUFJO1FBQ2xDLE9BQU9ELE9BQU9jLElBQUksQ0FBQyxFQUFFLENBQUNDLEdBQUcsRUFBRSw0QkFBNEI7SUFDekQ7SUFFUVgsYUFBYVksSUFBVSxFQUFtQjtRQUNoRCxPQUFPLElBQUlDLFFBQVEsQ0FBQ0MsU0FBU0M7WUFDM0IsTUFBTUMsU0FBUyxJQUFJQztZQUNuQkQsT0FBT0UsTUFBTSxHQUFHO2dCQUNkLE1BQU10QixTQUFTb0IsT0FBT3BCLE1BQU07Z0JBQzVCa0IsUUFBUWxCLE9BQU91QixLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyx1Q0FBdUM7WUFDeEU7WUFDQUgsT0FBT0ksT0FBTyxHQUFHTDtZQUNqQkMsT0FBT0ssYUFBYSxDQUFDVDtRQUN2QjtJQUNGO0lBRU81RCxlQUF3QjtRQUM3QixPQUFPLElBQUksQ0FBQ08sTUFBTSxDQUFDUCxZQUFZO0lBQ2pDO0lBRU9zRSxpQkFBeUI7UUFDOUIsT0FBTyxJQUFJLENBQUMvRCxNQUFNLENBQUNWLE9BQU87SUFDNUI7SUEvUEEwRSxhQUFjO2FBRk5yRCxtQkFBK0U7WUFBQztZQUFhO1lBQWE7WUFBVTtTQUFhO1FBR3ZJLElBQUksQ0FBQ1gsTUFBTSxHQUFHLElBQUksQ0FBQ25CLFVBQVU7SUFDL0I7QUE4UEY7QUFFQSw0QkFBNEI7QUFDckIsTUFBTW9GLFlBQVksSUFBSXJGLFlBQVkiLCJzb3VyY2VzIjpbIi9Vc2Vycy9sZWhvYW5nYW5oL0RvY3VtZW50cy9GQiBOZXR3b3JrL0ZFL3NyYy9saWIvYWktc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBSSBTZXJ2aWNlIC0gQXV0b21hdGljIENvbmZpZ3VyYXRpb24gd2l0aCBGYWxsYmFja1xuZXhwb3J0IGludGVyZmFjZSBBSVNlcnZpY2VDb25maWcge1xuICBzZXJ2aWNlOiAnc3RhYmlsaXR5JyB8ICdyZXBsaWNhdGUnIHwgJ29wZW5haScgfCAnb3BlbnJvdXRlcicgfCAnZGVtbyc7XG4gIGFwaUtleTogc3RyaW5nO1xuICBlbmRwb2ludDogc3RyaW5nO1xuICBpc0NvbmZpZ3VyZWQ6IGJvb2xlYW47XG59XG5cbmNsYXNzIEFJU2VydmljZSB7XG4gIHByaXZhdGUgY29uZmlnOiBBSVNlcnZpY2VDb25maWc7XG4gIHByaXZhdGUgZmFsbGJhY2tTZXJ2aWNlczogQXJyYXk8J3N0YWJpbGl0eScgfCAncmVwbGljYXRlJyB8ICdvcGVuYWknIHwgJ29wZW5yb3V0ZXInPiA9IFsnc3RhYmlsaXR5JywgJ3JlcGxpY2F0ZScsICdvcGVuYWknLCAnb3BlbnJvdXRlciddO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY29uZmlnID0gdGhpcy5sb2FkQ29uZmlnKCk7XG4gIH1cblxuICBwcml2YXRlIGxvYWRDb25maWcoKTogQUlTZXJ2aWNlQ29uZmlnIHtcbiAgICAvLyBMb2FkIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzIGF1dG9tYXRpY2FsbHlcbiAgICBjb25zdCBzdGFiaWxpdHlLZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVEFCSUxJVFlfQVBJX0tFWTtcbiAgICBjb25zdCByZXBsaWNhdGVLZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19SRVBMSUNBVEVfQVBJX0tFWTtcbiAgICBjb25zdCBvcGVuYWlLZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19PUEVOQUlfQVBJX0tFWTtcblxuICAgIC8vIFByaW9yaXR5OiBTdGFiaWxpdHkgQUkgPiBSZXBsaWNhdGUgPiBPcGVuQUkgPiBEZW1vXG4gICAgaWYgKHN0YWJpbGl0eUtleSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2VydmljZTogJ3N0YWJpbGl0eScsXG4gICAgICAgIGFwaUtleTogc3RhYmlsaXR5S2V5LFxuICAgICAgICBlbmRwb2ludDogJ2h0dHBzOi8vYXBpLnN0YWJpbGl0eS5haS92MS9nZW5lcmF0aW9uL3N0YWJsZS1kaWZmdXNpb24teGwtMTAyNC12MS0wL2ltYWdlLXRvLWltYWdlJyxcbiAgICAgICAgaXNDb25maWd1cmVkOiB0cnVlXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAocmVwbGljYXRlS2V5KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXJ2aWNlOiAncmVwbGljYXRlJyxcbiAgICAgICAgYXBpS2V5OiByZXBsaWNhdGVLZXksXG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9hcGkucmVwbGljYXRlLmNvbS92MS9wcmVkaWN0aW9ucycsXG4gICAgICAgIGlzQ29uZmlndXJlZDogdHJ1ZVxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKG9wZW5haUtleSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2VydmljZTogJ29wZW5haScsXG4gICAgICAgIGFwaUtleTogb3BlbmFpS2V5LFxuICAgICAgICBlbmRwb2ludDogJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvaW1hZ2VzL2dlbmVyYXRpb25zJyxcbiAgICAgICAgaXNDb25maWd1cmVkOiB0cnVlXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIHRvIGRlbW8gbW9kZVxuICAgIHJldHVybiB7XG4gICAgICBzZXJ2aWNlOiAnZGVtbycsXG4gICAgICBhcGlLZXk6ICcnLFxuICAgICAgZW5kcG9pbnQ6ICcnLFxuICAgICAgaXNDb25maWd1cmVkOiBmYWxzZVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldFNlcnZpY2VDb25maWcoc2VydmljZTogJ3N0YWJpbGl0eScgfCAncmVwbGljYXRlJyB8ICdvcGVuYWknKTogQUlTZXJ2aWNlQ29uZmlnIHwgbnVsbCB7XG4gICAgc3dpdGNoIChzZXJ2aWNlKSB7XG4gICAgICBjYXNlICdzdGFiaWxpdHknOlxuICAgICAgICBjb25zdCBzdGFiaWxpdHlLZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVEFCSUxJVFlfQVBJX0tFWTtcbiAgICAgICAgaWYgKHN0YWJpbGl0eUtleSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZXJ2aWNlOiAnc3RhYmlsaXR5JyxcbiAgICAgICAgICAgIGFwaUtleTogc3RhYmlsaXR5S2V5LFxuICAgICAgICAgICAgZW5kcG9pbnQ6ICdodHRwczovL2FwaS5zdGFiaWxpdHkuYWkvdjEvZ2VuZXJhdGlvbi9zdGFibGUtZGlmZnVzaW9uLXhsLTEwMjQtdjEtMC9pbWFnZS10by1pbWFnZScsXG4gICAgICAgICAgICBpc0NvbmZpZ3VyZWQ6IHRydWVcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncmVwbGljYXRlJzpcbiAgICAgICAgY29uc3QgcmVwbGljYXRlS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfUkVQTElDQVRFX0FQSV9LRVk7XG4gICAgICAgIGlmIChyZXBsaWNhdGVLZXkpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2VydmljZTogJ3JlcGxpY2F0ZScsXG4gICAgICAgICAgICBhcGlLZXk6IHJlcGxpY2F0ZUtleSxcbiAgICAgICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9hcGkucmVwbGljYXRlLmNvbS92MS9wcmVkaWN0aW9ucycsXG4gICAgICAgICAgICBpc0NvbmZpZ3VyZWQ6IHRydWVcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnb3BlbmFpJzpcbiAgICAgICAgY29uc3Qgb3BlbmFpS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfT1BFTkFJX0FQSV9LRVk7XG4gICAgICAgIGlmIChvcGVuYWlLZXkpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2VydmljZTogJ29wZW5haScsXG4gICAgICAgICAgICBhcGlLZXk6IG9wZW5haUtleSxcbiAgICAgICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MS9pbWFnZXMvZ2VuZXJhdGlvbnMnLFxuICAgICAgICAgICAgaXNDb25maWd1cmVkOiB0cnVlXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2VuZXJhdGVGb3hQZXJzb24oaW1hZ2VCbG9iOiBCbG9iLCBwcm9tcHQ6IHN0cmluZywgc3RyZW5ndGg6IG51bWJlcik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIFxuICAgIC8vIFRyeSB0aGUgY3VycmVudCBjb25maWd1cmVkIHNlcnZpY2UgZmlyc3RcbiAgICBpZiAodGhpcy5jb25maWcuaXNDb25maWd1cmVkKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmxvZyhgVHJ5aW5nICR7dGhpcy5jb25maWcuc2VydmljZX0gc2VydmljZWApO1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZW5lcmF0ZVdpdGhTZXJ2aWNlKHRoaXMuY29uZmlnLCBpbWFnZUJsb2IsIHByb21wdCwgc3RyZW5ndGgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpO1xuICAgICAgICBlcnJvcnMucHVzaChgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlfTogJHtlcnJvck1lc3NhZ2V9YCk7XG4gICAgICAgIGNvbnNvbGUud2FybihgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlfSBmYWlsZWQ6YCwgZXJyb3JNZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBUcnkgZmFsbGJhY2sgc2VydmljZXNcbiAgICBmb3IgKGNvbnN0IHNlcnZpY2Ugb2YgdGhpcy5mYWxsYmFja1NlcnZpY2VzKSB7XG4gICAgICBpZiAoc2VydmljZSA9PT0gdGhpcy5jb25maWcuc2VydmljZSkgY29udGludWU7IC8vIFNraXAgYWxyZWFkeSB0cmllZCBzZXJ2aWNlXG4gICAgICBcbiAgICAgIGNvbnN0IHNlcnZpY2VDb25maWcgPSB0aGlzLmdldFNlcnZpY2VDb25maWcoc2VydmljZSk7XG4gICAgICBpZiAoIXNlcnZpY2VDb25maWcpIGNvbnRpbnVlO1xuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmxvZyhgVHJ5aW5nIGZhbGxiYWNrICR7c2VydmljZX0gc2VydmljZWApO1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZW5lcmF0ZVdpdGhTZXJ2aWNlKHNlcnZpY2VDb25maWcsIGltYWdlQmxvYiwgcHJvbXB0LCBzdHJlbmd0aCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcik7XG4gICAgICAgIGVycm9ycy5wdXNoKGAke3NlcnZpY2V9OiAke2Vycm9yTWVzc2FnZX1gKTtcbiAgICAgICAgY29uc29sZS53YXJuKGAke3NlcnZpY2V9IGZhaWxlZDpgLCBlcnJvck1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFsbCBzZXJ2aWNlcyBmYWlsZWQgLSByZXR1cm4gZGVtbyBpbWFnZVxuICAgIGNvbnNvbGUud2FybignQWxsIEFJIHNlcnZpY2VzIGZhaWxlZCwgcmV0dXJuaW5nIGRlbW8gaW1hZ2UnKTtcbiAgICByZXR1cm4gdGhpcy5nZXREZW1vSW1hZ2UoKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RGVtb0ltYWdlKCk6IHN0cmluZyB7XG4gICAgLy8gUmV0dXJuIGEgZGVtbyBmb3ggcGVyc29uIGltYWdlIGZyb20gcHVibGljIGFzc2V0c1xuICAgIGNvbnN0IGRlbW9JbWFnZXMgPSBbXG4gICAgICAnL2ZveC5wbmcnLFxuICAgICAgJy9mb3gyLmpwZycsIFxuICAgICAgJy9mb3gzLmpwZycsXG4gICAgICAnL2ZveDQuanBnJyxcbiAgICAgICcvZm94NS5qcGcnXG4gICAgXTtcbiAgICBcbiAgICAvLyBSZXR1cm4gYSByYW5kb20gZGVtbyBpbWFnZVxuICAgIGNvbnN0IHJhbmRvbUltYWdlID0gZGVtb0ltYWdlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBkZW1vSW1hZ2VzLmxlbmd0aCldO1xuICAgIHJldHVybiByYW5kb21JbWFnZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVXaXRoU2VydmljZShjb25maWc6IEFJU2VydmljZUNvbmZpZywgaW1hZ2VCbG9iOiBCbG9iLCBwcm9tcHQ6IHN0cmluZywgc3RyZW5ndGg6IG51bWJlcik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgc3dpdGNoIChjb25maWcuc2VydmljZSkge1xuICAgICAgY2FzZSAnc3RhYmlsaXR5JzpcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2VuZXJhdGVXaXRoU3RhYmlsaXR5KGNvbmZpZywgaW1hZ2VCbG9iLCBwcm9tcHQsIHN0cmVuZ3RoKTtcbiAgICAgIGNhc2UgJ3JlcGxpY2F0ZSc6XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdlbmVyYXRlV2l0aFJlcGxpY2F0ZShjb25maWcsIGltYWdlQmxvYiwgcHJvbXB0LCBzdHJlbmd0aCk7XG4gICAgICBjYXNlICdvcGVuYWknOlxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZW5lcmF0ZVdpdGhPcGVuQUkoY29uZmlnLCBpbWFnZUJsb2IsIHByb21wdCwgc3RyZW5ndGgpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbnN1cHBvcnRlZCBzZXJ2aWNlJyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVdpdGhTdGFiaWxpdHkoY29uZmlnOiBBSVNlcnZpY2VDb25maWcsIGltYWdlQmxvYjogQmxvYiwgcHJvbXB0OiBzdHJpbmcsIHN0cmVuZ3RoOiBudW1iZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCdpbml0X2ltYWdlJywgaW1hZ2VCbG9iLCAnaW5wdXQuanBnJyk7XG4gICAgXG4gICAgLy8gSW5jbHVkZSBzdHJlbmd0aCBpbiB0aGUgcHJvbXB0IHRleHRcbiAgICBjb25zdCBzdHJlbmd0aFRleHQgPSBzdHJlbmd0aCA+PSAwLjggPyBcImhpZ2ggdHJhbnNmb3JtYXRpb25cIiA6IHN0cmVuZ3RoID49IDAuNSA/IFwibWVkaXVtIHRyYW5zZm9ybWF0aW9uXCIgOiBcInN1YnRsZSB0cmFuc2Zvcm1hdGlvblwiO1xuICAgIGNvbnN0IGVuaGFuY2VkUHJvbXB0ID0gYFRyYW5zZm9ybSB0aGlzIHBlcnNvbiBpbnRvIGEgYmVhdXRpZnVsIGZveCBwZXJzb24gd2l0aCAke3N0cmVuZ3RoVGV4dH06ICR7cHJvbXB0fSwgYW50aHJvcG9tb3JwaGljIGZveCwgZGV0YWlsZWQgb3JhbmdlIGZ1ciwgcG9pbnR5IGZveCBlYXJzLCBidXNoeSBmb3ggdGFpbCwgaHVtYW4tbGlrZSBib2R5LCBoaWdoIHF1YWxpdHksIGRldGFpbGVkLCBwcm9mZXNzaW9uYWwgcGhvdG9ncmFwaHlgO1xuICAgIGZvcm1EYXRhLmFwcGVuZCgndGV4dF9wcm9tcHRzWzBdW3RleHRdJywgZW5oYW5jZWRQcm9tcHQpO1xuICAgIGZvcm1EYXRhLmFwcGVuZCgndGV4dF9wcm9tcHRzWzBdW3dlaWdodF0nLCAnMScpO1xuICAgIGZvcm1EYXRhLmFwcGVuZCgndGV4dF9wcm9tcHRzWzFdW3RleHRdJywgJ2xvdyBxdWFsaXR5LCBibHVycnksIGRpc3RvcnRlZCwgYmFkIGFuYXRvbXksIGRlZm9ybWVkLCB1Z2x5LCBiYWQgcHJvcG9ydGlvbnMnKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ3RleHRfcHJvbXB0c1sxXVt3ZWlnaHRdJywgJy0xJyk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCdjZmdfc2NhbGUnLCAnNy41Jyk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCdzdGVwcycsICczMCcpO1xuICAgIGZvcm1EYXRhLmFwcGVuZCgnc2FtcGxlcycsICcxJyk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCdzdHlsZV9wcmVzZXQnLCAncGhvdG9ncmFwaGljJyk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGNvbmZpZy5lbmRwb2ludCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke2NvbmZpZy5hcGlLZXl9YCxcbiAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgICBib2R5OiBmb3JtRGF0YSxcbiAgICB9KTtcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgU3RhYmlsaXR5IEFJIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXN9IC0gJHtlcnJvclRleHR9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIFxuICAgIGlmIChyZXN1bHQuYXJ0aWZhY3RzICYmIHJlc3VsdC5hcnRpZmFjdHMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIGBkYXRhOmltYWdlL3BuZztiYXNlNjQsJHtyZXN1bHQuYXJ0aWZhY3RzWzBdLmJhc2U2NH1gO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGltYWdlIGdlbmVyYXRlZCcpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVXaXRoUmVwbGljYXRlKGNvbmZpZzogQUlTZXJ2aWNlQ29uZmlnLCBpbWFnZUJsb2I6IEJsb2IsIHByb21wdDogc3RyaW5nLCBzdHJlbmd0aDogbnVtYmVyKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAvLyBDb252ZXJ0IGJsb2IgdG8gYmFzZTY0XG4gICAgY29uc3QgYmFzZTY0ID0gYXdhaXQgdGhpcy5ibG9iVG9CYXNlNjQoaW1hZ2VCbG9iKTtcbiAgICBcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGNvbmZpZy5lbmRwb2ludCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdBdXRob3JpemF0aW9uJzogYFRva2VuICR7Y29uZmlnLmFwaUtleX1gLFxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdmVyc2lvbjogXCIzOWVkNTJmMmE3OGU5MzRiM2JhNmUyYTg5ZjViMWM3MTJkZTdkZmVhNTM1NTI1MjU1YjFhYTM1YzU1NjVlMDhiXCIsXG4gICAgICAgIGlucHV0OiB7XG4gICAgICAgICAgaW1hZ2U6IGJhc2U2NCxcbiAgICAgICAgICBwcm9tcHQ6IGBmb3ggcGVyc29uOiAke3Byb21wdH1gLFxuICAgICAgICAgIHN0cmVuZ3RoOiBzdHJlbmd0aFxuICAgICAgICB9XG4gICAgICB9KSxcbiAgICB9KTtcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUmVwbGljYXRlIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIHJldHVybiByZXN1bHQub3V0cHV0WzBdOyAvLyBSZXBsaWNhdGUgcmV0dXJucyBpbWFnZSBVUkxzXG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlV2l0aE9wZW5BSShjb25maWc6IEFJU2VydmljZUNvbmZpZywgaW1hZ2VCbG9iOiBCbG9iLCBwcm9tcHQ6IHN0cmluZywgc3RyZW5ndGg6IG51bWJlcik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChjb25maWcuZW5kcG9pbnQsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHtjb25maWcuYXBpS2V5fWAsXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBtb2RlbDogXCJkYWxsLWUtM1wiLFxuICAgICAgICBwcm9tcHQ6IGBUcmFuc2Zvcm0gdGhpcyBwZXJzb24gaW50byBhIGZveCBwZXJzb24gd2l0aCBzdHJlbmd0aCAke3N0cmVuZ3RofTogJHtwcm9tcHR9YCxcbiAgICAgICAgbjogMSxcbiAgICAgICAgc2l6ZTogXCIxMDI0eDEwMjRcIlxuICAgICAgfSksXG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE9wZW5BSSBmYWlsZWQ6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICByZXR1cm4gcmVzdWx0LmRhdGFbMF0udXJsOyAvLyBPcGVuQUkgcmV0dXJucyBpbWFnZSBVUkxzXG4gIH1cblxuICBwcml2YXRlIGJsb2JUb0Jhc2U2NChibG9iOiBCbG9iKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlYWRlci5yZXN1bHQgYXMgc3RyaW5nO1xuICAgICAgICByZXNvbHZlKHJlc3VsdC5zcGxpdCgnLCcpWzFdKTsgLy8gUmVtb3ZlIGRhdGE6aW1hZ2UvLi4uO2Jhc2U2NCwgcHJlZml4XG4gICAgICB9O1xuICAgICAgcmVhZGVyLm9uZXJyb3IgPSByZWplY3Q7XG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChibG9iKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBpc0NvbmZpZ3VyZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmlzQ29uZmlndXJlZDtcbiAgfVxuXG4gIHB1YmxpYyBnZXRTZXJ2aWNlTmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5zZXJ2aWNlO1xuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBhaVNlcnZpY2UgPSBuZXcgQUlTZXJ2aWNlKCk7Il0sIm5hbWVzIjpbIkFJU2VydmljZSIsImxvYWRDb25maWciLCJzdGFiaWxpdHlLZXkiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1RBQklMSVRZX0FQSV9LRVkiLCJyZXBsaWNhdGVLZXkiLCJORVhUX1BVQkxJQ19SRVBMSUNBVEVfQVBJX0tFWSIsIm9wZW5haUtleSIsIk5FWFRfUFVCTElDX09QRU5BSV9BUElfS0VZIiwic2VydmljZSIsImFwaUtleSIsImVuZHBvaW50IiwiaXNDb25maWd1cmVkIiwiZ2V0U2VydmljZUNvbmZpZyIsImdlbmVyYXRlRm94UGVyc29uIiwiaW1hZ2VCbG9iIiwicHJvbXB0Iiwic3RyZW5ndGgiLCJlcnJvcnMiLCJjb25maWciLCJjb25zb2xlIiwibG9nIiwiZ2VuZXJhdGVXaXRoU2VydmljZSIsImVycm9yIiwiZXJyb3JNZXNzYWdlIiwiRXJyb3IiLCJtZXNzYWdlIiwiU3RyaW5nIiwicHVzaCIsIndhcm4iLCJmYWxsYmFja1NlcnZpY2VzIiwic2VydmljZUNvbmZpZyIsImdldERlbW9JbWFnZSIsImRlbW9JbWFnZXMiLCJyYW5kb21JbWFnZSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsImdlbmVyYXRlV2l0aFN0YWJpbGl0eSIsImdlbmVyYXRlV2l0aFJlcGxpY2F0ZSIsImdlbmVyYXRlV2l0aE9wZW5BSSIsImZvcm1EYXRhIiwiRm9ybURhdGEiLCJhcHBlbmQiLCJzdHJlbmd0aFRleHQiLCJlbmhhbmNlZFByb21wdCIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIm9rIiwiZXJyb3JUZXh0IiwidGV4dCIsInN0YXR1cyIsInJlc3VsdCIsImpzb24iLCJhcnRpZmFjdHMiLCJiYXNlNjQiLCJibG9iVG9CYXNlNjQiLCJKU09OIiwic3RyaW5naWZ5IiwidmVyc2lvbiIsImlucHV0IiwiaW1hZ2UiLCJvdXRwdXQiLCJtb2RlbCIsIm4iLCJzaXplIiwiZGF0YSIsInVybCIsImJsb2IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJzcGxpdCIsIm9uZXJyb3IiLCJyZWFkQXNEYXRhVVJMIiwiZ2V0U2VydmljZU5hbWUiLCJjb25zdHJ1Y3RvciIsImFpU2VydmljZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(app-pages-browser)/./src/lib/ai-service.ts\n"));

/***/ })

});