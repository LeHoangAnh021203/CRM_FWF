"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("app/generateAI/page",{

/***/ "(app-pages-browser)/./src/lib/ai-service.ts":
/*!*******************************!*\
  !*** ./src/lib/ai-service.ts ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   aiService: () => (/* binding */ aiService)\n/* harmony export */ });\n// AI Service - Automatic Configuration with Fallback\nclass AIService {\n    loadConfig() {\n        // Load from environment variables automatically\n        const stabilityKey = \"sk-CHoGTOr0amzOFTw5kFQh0tIDVl5gsrEoJeuu3ENbXr7tnDJM\";\n        const replicateKey = \"r8_H4zWx5r0UAQg6iJmKgNiVbWCa0wNw083qIba4\";\n        const openaiKey = \"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\";\n        // Priority: Stability AI > Replicate > OpenAI > Demo\n        if (stabilityKey) {\n            return {\n                service: 'stability',\n                apiKey: stabilityKey,\n                endpoint: 'https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/image-to-image',\n                isConfigured: true\n            };\n        } else if (replicateKey) {\n            return {\n                service: 'replicate',\n                apiKey: replicateKey,\n                endpoint: 'https://api.replicate.com/v1/predictions',\n                isConfigured: true\n            };\n        } else if (openaiKey) {\n            return {\n                service: 'openai',\n                apiKey: openaiKey,\n                endpoint: 'https://api.openai.com/v1/images/generations',\n                isConfigured: true\n            };\n        }\n        // Fallback to demo mode\n        return {\n            service: 'demo',\n            apiKey: '',\n            endpoint: '',\n            isConfigured: false\n        };\n    }\n    getServiceConfig(service) {\n        switch(service){\n            case 'stability':\n                const stabilityKey = \"sk-CHoGTOr0amzOFTw5kFQh0tIDVl5gsrEoJeuu3ENbXr7tnDJM\";\n                if (stabilityKey) {\n                    return {\n                        service: 'stability',\n                        apiKey: stabilityKey,\n                        endpoint: 'https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/image-to-image',\n                        isConfigured: true\n                    };\n                }\n                break;\n            case 'replicate':\n                const replicateKey = \"r8_H4zWx5r0UAQg6iJmKgNiVbWCa0wNw083qIba4\";\n                if (replicateKey) {\n                    return {\n                        service: 'replicate',\n                        apiKey: replicateKey,\n                        endpoint: 'https://api.replicate.com/v1/predictions',\n                        isConfigured: true\n                    };\n                }\n                break;\n            case 'openai':\n                const openaiKey = \"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\";\n                if (openaiKey) {\n                    return {\n                        service: 'openai',\n                        apiKey: openaiKey,\n                        endpoint: 'https://api.openai.com/v1/images/generations',\n                        isConfigured: true\n                    };\n                }\n                break;\n        }\n        return null;\n    }\n    async generateFoxPerson(imageBlob, prompt, strength) {\n        const errors = [];\n        // Try the current configured service first\n        if (this.config.isConfigured) {\n            try {\n                console.log(\"Trying \".concat(this.config.service, \" service\"));\n                return await this.generateWithService(this.config, imageBlob, prompt, strength);\n            } catch (error) {\n                const errorMessage = error instanceof Error ? error.message : String(error);\n                errors.push(\"\".concat(this.config.service, \": \").concat(errorMessage));\n                console.warn(\"\".concat(this.config.service, \" failed:\"), errorMessage);\n            }\n        }\n        // Try fallback services\n        for (const service of this.fallbackServices){\n            if (service === this.config.service) continue; // Skip already tried service\n            const serviceConfig = this.getServiceConfig(service);\n            if (!serviceConfig) continue;\n            try {\n                console.log(\"Trying fallback \".concat(service, \" service\"));\n                return await this.generateWithService(serviceConfig, imageBlob, prompt, strength);\n            } catch (error) {\n                const errorMessage = error instanceof Error ? error.message : String(error);\n                errors.push(\"\".concat(service, \": \").concat(errorMessage));\n                console.warn(\"\".concat(service, \" failed:\"), errorMessage);\n            }\n        }\n        // All services failed - return demo image\n        console.warn('All AI services failed, returning demo image');\n        return this.getDemoImage();\n    }\n    getDemoImage() {\n        // Return a demo fox person image from public assets\n        const demoImages = [\n            '/fox.png',\n            '/fox2.jpg',\n            '/fox3.jpg',\n            '/fox4.jpg',\n            '/fox5.jpg'\n        ];\n        // Return a random demo image\n        const randomImage = demoImages[Math.floor(Math.random() * demoImages.length)];\n        return randomImage;\n    }\n    async generateWithService(config, imageBlob, prompt, strength) {\n        switch(config.service){\n            case 'stability':\n                return await this.generateWithStability(config, imageBlob, prompt, strength);\n            case 'replicate':\n                return await this.generateWithReplicate(config, imageBlob, prompt, strength);\n            case 'openai':\n                return await this.generateWithOpenAI(config, imageBlob, prompt, strength);\n            default:\n                throw new Error('Unsupported service');\n        }\n    }\n    async generateWithStability(config, imageBlob, prompt, strength) {\n        const formData = new FormData();\n        formData.append('init_image', imageBlob, 'input.jpg');\n        // Include strength in the prompt text\n        const strengthText = strength >= 0.8 ? \"high transformation\" : strength >= 0.5 ? \"medium transformation\" : \"subtle transformation\";\n        const enhancedPrompt = \"Transform this person into a beautiful fox person with \".concat(strengthText, \": \").concat(prompt, \", anthropomorphic fox, detailed orange fur, pointy fox ears, bushy fox tail, human-like body, high quality, detailed, professional photography\");\n        formData.append('text_prompts[0][text]', enhancedPrompt);\n        formData.append('text_prompts[0][weight]', '1');\n        formData.append('text_prompts[1][text]', 'low quality, blurry, distorted, bad anatomy, deformed, ugly, bad proportions');\n        formData.append('text_prompts[1][weight]', '-1');\n        formData.append('cfg_scale', '7.5');\n        formData.append('steps', '30');\n        formData.append('samples', '1');\n        formData.append('style_preset', 'photographic');\n        const response = await fetch(config.endpoint, {\n            method: 'POST',\n            headers: {\n                'Authorization': \"Bearer \".concat(config.apiKey),\n                'Accept': 'application/json'\n            },\n            body: formData\n        });\n        if (!response.ok) {\n            const errorText = await response.text();\n            throw new Error(\"Stability AI failed: \".concat(response.status, \" - \").concat(errorText));\n        }\n        const result = await response.json();\n        if (result.artifacts && result.artifacts.length > 0) {\n            return \"data:image/png;base64,\".concat(result.artifacts[0].base64);\n        } else {\n            throw new Error('No image generated');\n        }\n    }\n    async generateWithReplicate(config, imageBlob, prompt, strength) {\n        // Convert blob to base64\n        const base64 = await this.blobToBase64(imageBlob);\n        const response = await fetch(config.endpoint, {\n            method: 'POST',\n            headers: {\n                'Authorization': \"Token \".concat(config.apiKey),\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                version: \"39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b\",\n                input: {\n                    image: base64,\n                    prompt: \"fox person: \".concat(prompt),\n                    strength: strength\n                }\n            })\n        });\n        if (!response.ok) {\n            throw new Error(\"Replicate failed: \".concat(response.status));\n        }\n        const result = await response.json();\n        return result.output[0]; // Replicate returns image URLs\n    }\n    async generateWithOpenAI(config, imageBlob, prompt, strength) {\n        const response = await fetch(config.endpoint, {\n            method: 'POST',\n            headers: {\n                'Authorization': \"Bearer \".concat(config.apiKey),\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                model: \"dall-e-3\",\n                prompt: \"Transform this person into a fox person with strength \".concat(strength, \": \").concat(prompt),\n                n: 1,\n                size: \"1024x1024\"\n            })\n        });\n        if (!response.ok) {\n            throw new Error(\"OpenAI failed: \".concat(response.status));\n        }\n        const result = await response.json();\n        return result.data[0].url; // OpenAI returns image URLs\n    }\n    blobToBase64(blob) {\n        return new Promise((resolve, reject)=>{\n            const reader = new FileReader();\n            reader.onload = ()=>{\n                const result = reader.result;\n                resolve(result.split(',')[1]); // Remove data:image/...;base64, prefix\n            };\n            reader.onerror = reject;\n            reader.readAsDataURL(blob);\n        });\n    }\n    isConfigured() {\n        return this.config.isConfigured;\n    }\n    getServiceName() {\n        return this.config.service;\n    }\n    constructor(){\n        this.fallbackServices = [\n            'stability',\n            'replicate',\n            'openai'\n        ];\n        this.config = this.loadConfig();\n    }\n}\n// Export singleton instance\nconst aiService = new AIService();\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL3NyYy9saWIvYWktc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEscURBQXFEO0FBUXJELE1BQU1BO0lBUUlDLGFBQThCO1FBQ3BDLGdEQUFnRDtRQUNoRCxNQUFNQyxlQUFlQyxxREFBeUM7UUFDOUQsTUFBTUcsZUFBZUgsMENBQXlDO1FBQzlELE1BQU1LLFlBQVlMLHNLQUFzQztRQUV4RCxxREFBcUQ7UUFDckQsSUFBSUQsY0FBYztZQUNoQixPQUFPO2dCQUNMUSxTQUFTO2dCQUNUQyxRQUFRVDtnQkFDUlUsVUFBVTtnQkFDVkMsY0FBYztZQUNoQjtRQUNGLE9BQU8sSUFBSVAsY0FBYztZQUN2QixPQUFPO2dCQUNMSSxTQUFTO2dCQUNUQyxRQUFRTDtnQkFDUk0sVUFBVTtnQkFDVkMsY0FBYztZQUNoQjtRQUNGLE9BQU8sSUFBSUwsV0FBVztZQUNwQixPQUFPO2dCQUNMRSxTQUFTO2dCQUNUQyxRQUFRSDtnQkFDUkksVUFBVTtnQkFDVkMsY0FBYztZQUNoQjtRQUNGO1FBRUEsd0JBQXdCO1FBQ3hCLE9BQU87WUFDTEgsU0FBUztZQUNUQyxRQUFRO1lBQ1JDLFVBQVU7WUFDVkMsY0FBYztRQUNoQjtJQUNGO0lBRVFDLGlCQUFpQkosT0FBNkMsRUFBMEI7UUFDOUYsT0FBUUE7WUFDTixLQUFLO2dCQUNILE1BQU1SLGVBQWVDLHFEQUF5QztnQkFDOUQsSUFBSUQsY0FBYztvQkFDaEIsT0FBTzt3QkFDTFEsU0FBUzt3QkFDVEMsUUFBUVQ7d0JBQ1JVLFVBQVU7d0JBQ1ZDLGNBQWM7b0JBQ2hCO2dCQUNGO2dCQUNBO1lBQ0YsS0FBSztnQkFDSCxNQUFNUCxlQUFlSCwwQ0FBeUM7Z0JBQzlELElBQUlHLGNBQWM7b0JBQ2hCLE9BQU87d0JBQ0xJLFNBQVM7d0JBQ1RDLFFBQVFMO3dCQUNSTSxVQUFVO3dCQUNWQyxjQUFjO29CQUNoQjtnQkFDRjtnQkFDQTtZQUNGLEtBQUs7Z0JBQ0gsTUFBTUwsWUFBWUwsc0tBQXNDO2dC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TSxrQkFBa0MsT0FBaEJzQixTQUFTUSxNQUFNO1FBQ25EO1FBRUEsTUFBTUMsU0FBUyxNQUFNVCxTQUFTVSxJQUFJO1FBQ2xDLE9BQU9ELE9BQU9jLElBQUksQ0FBQyxFQUFFLENBQUNDLEdBQUcsRUFBRSw0QkFBNEI7SUFDekQ7SUFFUVgsYUFBYVksSUFBVSxFQUFtQjtRQUNoRCxPQUFPLElBQUlDLFFBQVEsQ0FBQ0MsU0FBU0M7WUFDM0IsTUFBTUMsU0FBUyxJQUFJQztZQUNuQkQsT0FBT0UsTUFBTSxHQUFHO2dCQUNkLE1BQU10QixTQUFTb0IsT0FBT3BCLE1BQU07Z0JBQzVCa0IsUUFBUWxCLE9BQU91QixLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyx1Q0FBdUM7WUFDeEU7WUFDQUgsT0FBT0ksT0FBTyxHQUFHTDtZQUNqQkMsT0FBT0ssYUFBYSxDQUFDVDtRQUN2QjtJQUNGO0lBRU81RCxlQUF3QjtRQUM3QixPQUFPLElBQUksQ0FBQ08sTUFBTSxDQUFDUCxZQUFZO0lBQ2pDO0lBRU9zRSxpQkFBeUI7UUFDOUIsT0FBTyxJQUFJLENBQUMvRCxNQUFNLENBQUNWLE9BQU87SUFDNUI7SUEvUEEwRSxhQUFjO2FBRk5yRCxtQkFBZ0U7WUFBQztZQUFhO1lBQWE7U0FBUztRQUcxRyxJQUFJLENBQUNYLE1BQU0sR0FBRyxJQUFJLENBQUNuQixVQUFVO0lBQy9CO0FBOFBGO0FBRUEsNEJBQTRCO0FBQ3JCLE1BQU1vRixZQUFZLElBQUlyRixZQUFZIiwic291cmNlcyI6WyIvVXNlcnMvbGVob2FuZ2FuaC9Eb2N1bWVudHMvRkIgTmV0d29yay9GRS9zcmMvbGliL2FpLXNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQUkgU2VydmljZSAtIEF1dG9tYXRpYyBDb25maWd1cmF0aW9uIHdpdGggRmFsbGJhY2tcbmV4cG9ydCBpbnRlcmZhY2UgQUlTZXJ2aWNlQ29uZmlnIHtcbiAgc2VydmljZTogJ3N0YWJpbGl0eScgfCAncmVwbGljYXRlJyB8ICdvcGVuYWknIHwgJ29wZW5yb3V0ZXInIHwgJ2RlbW8nO1xuICBhcGlLZXk6IHN0cmluZztcbiAgZW5kcG9pbnQ6IHN0cmluZztcbiAgaXNDb25maWd1cmVkOiBib29sZWFuO1xufVxuXG5jbGFzcyBBSVNlcnZpY2Uge1xuICBwcml2YXRlIGNvbmZpZzogQUlTZXJ2aWNlQ29uZmlnO1xuICBwcml2YXRlIGZhbGxiYWNrU2VydmljZXM6IEFycmF5PCdzdGFiaWxpdHknIHwgJ3JlcGxpY2F0ZScgfCAnb3BlbmFpJz4gPSBbJ3N0YWJpbGl0eScsICdyZXBsaWNhdGUnLCAnb3BlbmFpJ107XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jb25maWcgPSB0aGlzLmxvYWRDb25maWcoKTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZENvbmZpZygpOiBBSVNlcnZpY2VDb25maWcge1xuICAgIC8vIExvYWQgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYXV0b21hdGljYWxseVxuICAgIGNvbnN0IHN0YWJpbGl0eUtleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NUQUJJTElUWV9BUElfS0VZO1xuICAgIGNvbnN0IHJlcGxpY2F0ZUtleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1JFUExJQ0FURV9BUElfS0VZO1xuICAgIGNvbnN0IG9wZW5haUtleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX09QRU5BSV9BUElfS0VZO1xuXG4gICAgLy8gUHJpb3JpdHk6IFN0YWJpbGl0eSBBSSA+IFJlcGxpY2F0ZSA+IE9wZW5BSSA+IERlbW9cbiAgICBpZiAoc3RhYmlsaXR5S2V5KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXJ2aWNlOiAnc3RhYmlsaXR5JyxcbiAgICAgICAgYXBpS2V5OiBzdGFiaWxpdHlLZXksXG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9hcGkuc3RhYmlsaXR5LmFpL3YxL2dlbmVyYXRpb24vc3RhYmxlLWRpZmZ1c2lvbi14bC0xMDI0LXYxLTAvaW1hZ2UtdG8taW1hZ2UnLFxuICAgICAgICBpc0NvbmZpZ3VyZWQ6IHRydWVcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChyZXBsaWNhdGVLZXkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNlcnZpY2U6ICdyZXBsaWNhdGUnLFxuICAgICAgICBhcGlLZXk6IHJlcGxpY2F0ZUtleSxcbiAgICAgICAgZW5kcG9pbnQ6ICdodHRwczovL2FwaS5yZXBsaWNhdGUuY29tL3YxL3ByZWRpY3Rpb25zJyxcbiAgICAgICAgaXNDb25maWd1cmVkOiB0cnVlXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAob3BlbmFpS2V5KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXJ2aWNlOiAnb3BlbmFpJyxcbiAgICAgICAgYXBpS2V5OiBvcGVuYWlLZXksXG4gICAgICAgIGVuZHBvaW50OiAnaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MS9pbWFnZXMvZ2VuZXJhdGlvbnMnLFxuICAgICAgICBpc0NvbmZpZ3VyZWQ6IHRydWVcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gRmFsbGJhY2sgdG8gZGVtbyBtb2RlXG4gICAgcmV0dXJuIHtcbiAgICAgIHNlcnZpY2U6ICdkZW1vJyxcbiAgICAgIGFwaUtleTogJycsXG4gICAgICBlbmRwb2ludDogJycsXG4gICAgICBpc0NvbmZpZ3VyZWQ6IGZhbHNlXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2VydmljZUNvbmZpZyhzZXJ2aWNlOiAnc3RhYmlsaXR5JyB8ICdyZXBsaWNhdGUnIHwgJ29wZW5haScpOiBBSVNlcnZpY2VDb25maWcgfCBudWxsIHtcbiAgICBzd2l0Y2ggKHNlcnZpY2UpIHtcbiAgICAgIGNhc2UgJ3N0YWJpbGl0eSc6XG4gICAgICAgIGNvbnN0IHN0YWJpbGl0eUtleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NUQUJJTElUWV9BUElfS0VZO1xuICAgICAgICBpZiAoc3RhYmlsaXR5S2V5KSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNlcnZpY2U6ICdzdGFiaWxpdHknLFxuICAgICAgICAgICAgYXBpS2V5OiBzdGFiaWxpdHlLZXksXG4gICAgICAgICAgICBlbmRwb2ludDogJ2h0dHBzOi8vYXBpLnN0YWJpbGl0eS5haS92MS9nZW5lcmF0aW9uL3N0YWJsZS1kaWZmdXNpb24teGwtMTAyNC12MS0wL2ltYWdlLXRvLWltYWdlJyxcbiAgICAgICAgICAgIGlzQ29uZmlndXJlZDogdHJ1ZVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyZXBsaWNhdGUnOlxuICAgICAgICBjb25zdCByZXBsaWNhdGVLZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19SRVBMSUNBVEVfQVBJX0tFWTtcbiAgICAgICAgaWYgKHJlcGxpY2F0ZUtleSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZXJ2aWNlOiAncmVwbGljYXRlJyxcbiAgICAgICAgICAgIGFwaUtleTogcmVwbGljYXRlS2V5LFxuICAgICAgICAgICAgZW5kcG9pbnQ6ICdodHRwczovL2FwaS5yZXBsaWNhdGUuY29tL3YxL3ByZWRpY3Rpb25zJyxcbiAgICAgICAgICAgIGlzQ29uZmlndXJlZDogdHJ1ZVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdvcGVuYWknOlxuICAgICAgICBjb25zdCBvcGVuYWlLZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19PUEVOQUlfQVBJX0tFWTtcbiAgICAgICAgaWYgKG9wZW5haUtleSkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzZXJ2aWNlOiAnb3BlbmFpJyxcbiAgICAgICAgICAgIGFwaUtleTogb3BlbmFpS2V5LFxuICAgICAgICAgICAgZW5kcG9pbnQ6ICdodHRwczovL2FwaS5vcGVuYWkuY29tL3YxL2ltYWdlcy9nZW5lcmF0aW9ucycsXG4gICAgICAgICAgICBpc0NvbmZpZ3VyZWQ6IHRydWVcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZW5lcmF0ZUZveFBlcnNvbihpbWFnZUJsb2I6IEJsb2IsIHByb21wdDogc3RyaW5nLCBzdHJlbmd0aDogbnVtYmVyKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgXG4gICAgLy8gVHJ5IHRoZSBjdXJyZW50IGNvbmZpZ3VyZWQgc2VydmljZSBmaXJzdFxuICAgIGlmICh0aGlzLmNvbmZpZy5pc0NvbmZpZ3VyZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBUcnlpbmcgJHt0aGlzLmNvbmZpZy5zZXJ2aWNlfSBzZXJ2aWNlYCk7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdlbmVyYXRlV2l0aFNlcnZpY2UodGhpcy5jb25maWcsIGltYWdlQmxvYiwgcHJvbXB0LCBzdHJlbmd0aCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcik7XG4gICAgICAgIGVycm9ycy5wdXNoKGAke3RoaXMuY29uZmlnLnNlcnZpY2V9OiAke2Vycm9yTWVzc2FnZX1gKTtcbiAgICAgICAgY29uc29sZS53YXJuKGAke3RoaXMuY29uZmlnLnNlcnZpY2V9IGZhaWxlZDpgLCBlcnJvck1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFRyeSBmYWxsYmFjayBzZXJ2aWNlc1xuICAgIGZvciAoY29uc3Qgc2VydmljZSBvZiB0aGlzLmZhbGxiYWNrU2VydmljZXMpIHtcbiAgICAgIGlmIChzZXJ2aWNlID09PSB0aGlzLmNvbmZpZy5zZXJ2aWNlKSBjb250aW51ZTsgLy8gU2tpcCBhbHJlYWR5IHRyaWVkIHNlcnZpY2VcbiAgICAgIFxuICAgICAgY29uc3Qgc2VydmljZUNvbmZpZyA9IHRoaXMuZ2V0U2VydmljZUNvbmZpZyhzZXJ2aWNlKTtcbiAgICAgIGlmICghc2VydmljZUNvbmZpZykgY29udGludWU7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBUcnlpbmcgZmFsbGJhY2sgJHtzZXJ2aWNlfSBzZXJ2aWNlYCk7XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdlbmVyYXRlV2l0aFNlcnZpY2Uoc2VydmljZUNvbmZpZywgaW1hZ2VCbG9iLCBwcm9tcHQsIHN0cmVuZ3RoKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKTtcbiAgICAgICAgZXJyb3JzLnB1c2goYCR7c2VydmljZX06ICR7ZXJyb3JNZXNzYWdlfWApO1xuICAgICAgICBjb25zb2xlLndhcm4oYCR7c2VydmljZX0gZmFpbGVkOmAsIGVycm9yTWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQWxsIHNlcnZpY2VzIGZhaWxlZCAtIHJldHVybiBkZW1vIGltYWdlXG4gICAgY29uc29sZS53YXJuKCdBbGwgQUkgc2VydmljZXMgZmFpbGVkLCByZXR1cm5pbmcgZGVtbyBpbWFnZScpO1xuICAgIHJldHVybiB0aGlzLmdldERlbW9JbWFnZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREZW1vSW1hZ2UoKTogc3RyaW5nIHtcbiAgICAvLyBSZXR1cm4gYSBkZW1vIGZveCBwZXJzb24gaW1hZ2UgZnJvbSBwdWJsaWMgYXNzZXRzXG4gICAgY29uc3QgZGVtb0ltYWdlcyA9IFtcbiAgICAgICcvZm94LnBuZycsXG4gICAgICAnL2ZveDIuanBnJywgXG4gICAgICAnL2ZveDMuanBnJyxcbiAgICAgICcvZm94NC5qcGcnLFxuICAgICAgJy9mb3g1LmpwZydcbiAgICBdO1xuICAgIFxuICAgIC8vIFJldHVybiBhIHJhbmRvbSBkZW1vIGltYWdlXG4gICAgY29uc3QgcmFuZG9tSW1hZ2UgPSBkZW1vSW1hZ2VzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGRlbW9JbWFnZXMubGVuZ3RoKV07XG4gICAgcmV0dXJuIHJhbmRvbUltYWdlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVdpdGhTZXJ2aWNlKGNvbmZpZzogQUlTZXJ2aWNlQ29uZmlnLCBpbWFnZUJsb2I6IEJsb2IsIHByb21wdDogc3RyaW5nLCBzdHJlbmd0aDogbnVtYmVyKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBzd2l0Y2ggKGNvbmZpZy5zZXJ2aWNlKSB7XG4gICAgICBjYXNlICdzdGFiaWxpdHknOlxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZW5lcmF0ZVdpdGhTdGFiaWxpdHkoY29uZmlnLCBpbWFnZUJsb2IsIHByb21wdCwgc3RyZW5ndGgpO1xuICAgICAgY2FzZSAncmVwbGljYXRlJzpcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2VuZXJhdGVXaXRoUmVwbGljYXRlKGNvbmZpZywgaW1hZ2VCbG9iLCBwcm9tcHQsIHN0cmVuZ3RoKTtcbiAgICAgIGNhc2UgJ29wZW5haSc6XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdlbmVyYXRlV2l0aE9wZW5BSShjb25maWcsIGltYWdlQmxvYiwgcHJvbXB0LCBzdHJlbmd0aCk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIHNlcnZpY2UnKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlV2l0aFN0YWJpbGl0eShjb25maWc6IEFJU2VydmljZUNvbmZpZywgaW1hZ2VCbG9iOiBCbG9iLCBwcm9tcHQ6IHN0cmluZywgc3RyZW5ndGg6IG51bWJlcik6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ2luaXRfaW1hZ2UnLCBpbWFnZUJsb2IsICdpbnB1dC5qcGcnKTtcbiAgICBcbiAgICAvLyBJbmNsdWRlIHN0cmVuZ3RoIGluIHRoZSBwcm9tcHQgdGV4dFxuICAgIGNvbnN0IHN0cmVuZ3RoVGV4dCA9IHN0cmVuZ3RoID49IDAuOCA/IFwiaGlnaCB0cmFuc2Zvcm1hdGlvblwiIDogc3RyZW5ndGggPj0gMC41ID8gXCJtZWRpdW0gdHJhbnNmb3JtYXRpb25cIiA6IFwic3VidGxlIHRyYW5zZm9ybWF0aW9uXCI7XG4gICAgY29uc3QgZW5oYW5jZWRQcm9tcHQgPSBgVHJhbnNmb3JtIHRoaXMgcGVyc29uIGludG8gYSBiZWF1dGlmdWwgZm94IHBlcnNvbiB3aXRoICR7c3RyZW5ndGhUZXh0fTogJHtwcm9tcHR9LCBhbnRocm9wb21vcnBoaWMgZm94LCBkZXRhaWxlZCBvcmFuZ2UgZnVyLCBwb2ludHkgZm94IGVhcnMsIGJ1c2h5IGZveCB0YWlsLCBodW1hbi1saWtlIGJvZHksIGhpZ2ggcXVhbGl0eSwgZGV0YWlsZWQsIHByb2Zlc3Npb25hbCBwaG90b2dyYXBoeWA7XG4gICAgZm9ybURhdGEuYXBwZW5kKCd0ZXh0X3Byb21wdHNbMF1bdGV4dF0nLCBlbmhhbmNlZFByb21wdCk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCd0ZXh0X3Byb21wdHNbMF1bd2VpZ2h0XScsICcxJyk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCd0ZXh0X3Byb21wdHNbMV1bdGV4dF0nLCAnbG93IHF1YWxpdHksIGJsdXJyeSwgZGlzdG9ydGVkLCBiYWQgYW5hdG9teSwgZGVmb3JtZWQsIHVnbHksIGJhZCBwcm9wb3J0aW9ucycpO1xuICAgIGZvcm1EYXRhLmFwcGVuZCgndGV4dF9wcm9tcHRzWzFdW3dlaWdodF0nLCAnLTEnKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ2NmZ19zY2FsZScsICc3LjUnKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ3N0ZXBzJywgJzMwJyk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCdzYW1wbGVzJywgJzEnKTtcbiAgICBmb3JtRGF0YS5hcHBlbmQoJ3N0eWxlX3ByZXNldCcsICdwaG90b2dyYXBoaWMnKTtcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goY29uZmlnLmVuZHBvaW50LCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7Y29uZmlnLmFwaUtleX1gLFxuICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgIH0pO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBTdGFiaWxpdHkgQUkgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c30gLSAke2Vycm9yVGV4dH1gKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgXG4gICAgaWYgKHJlc3VsdC5hcnRpZmFjdHMgJiYgcmVzdWx0LmFydGlmYWN0cy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gYGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwke3Jlc3VsdC5hcnRpZmFjdHNbMF0uYmFzZTY0fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTm8gaW1hZ2UgZ2VuZXJhdGVkJyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVdpdGhSZXBsaWNhdGUoY29uZmlnOiBBSVNlcnZpY2VDb25maWcsIGltYWdlQmxvYjogQmxvYiwgcHJvbXB0OiBzdHJpbmcsIHN0cmVuZ3RoOiBudW1iZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIC8vIENvbnZlcnQgYmxvYiB0byBiYXNlNjRcbiAgICBjb25zdCBiYXNlNjQgPSBhd2FpdCB0aGlzLmJsb2JUb0Jhc2U2NChpbWFnZUJsb2IpO1xuICAgIFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goY29uZmlnLmVuZHBvaW50LCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgVG9rZW4gJHtjb25maWcuYXBpS2V5fWAsXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB2ZXJzaW9uOiBcIjM5ZWQ1MmYyYTc4ZTkzNGIzYmE2ZTJhODlmNWIxYzcxMmRlN2RmZWE1MzU1MjUyNTViMWFhMzVjNTU2NWUwOGJcIixcbiAgICAgICAgaW5wdXQ6IHtcbiAgICAgICAgICBpbWFnZTogYmFzZTY0LFxuICAgICAgICAgIHByb21wdDogYGZveCBwZXJzb246ICR7cHJvbXB0fWAsXG4gICAgICAgICAgc3RyZW5ndGg6IHN0cmVuZ3RoXG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBSZXBsaWNhdGUgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c31gKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgcmV0dXJuIHJlc3VsdC5vdXRwdXRbMF07IC8vIFJlcGxpY2F0ZSByZXR1cm5zIGltYWdlIFVSTHNcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVXaXRoT3BlbkFJKGNvbmZpZzogQUlTZXJ2aWNlQ29uZmlnLCBpbWFnZUJsb2I6IEJsb2IsIHByb21wdDogc3RyaW5nLCBzdHJlbmd0aDogbnVtYmVyKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGNvbmZpZy5lbmRwb2ludCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke2NvbmZpZy5hcGlLZXl9YCxcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG1vZGVsOiBcImRhbGwtZS0zXCIsXG4gICAgICAgIHByb21wdDogYFRyYW5zZm9ybSB0aGlzIHBlcnNvbiBpbnRvIGEgZm94IHBlcnNvbiB3aXRoIHN0cmVuZ3RoICR7c3RyZW5ndGh9OiAke3Byb21wdH1gLFxuICAgICAgICBuOiAxLFxuICAgICAgICBzaXplOiBcIjEwMjR4MTAyNFwiXG4gICAgICB9KSxcbiAgICB9KTtcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgT3BlbkFJIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgIHJldHVybiByZXN1bHQuZGF0YVswXS51cmw7IC8vIE9wZW5BSSByZXR1cm5zIGltYWdlIFVSTHNcbiAgfVxuXG4gIHByaXZhdGUgYmxvYlRvQmFzZTY0KGJsb2I6IEJsb2IpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gcmVhZGVyLnJlc3VsdCBhcyBzdHJpbmc7XG4gICAgICAgIHJlc29sdmUocmVzdWx0LnNwbGl0KCcsJylbMV0pOyAvLyBSZW1vdmUgZGF0YTppbWFnZS8uLi47YmFzZTY0LCBwcmVmaXhcbiAgICAgIH07XG4gICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDtcbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGJsb2IpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGlzQ29uZmlndXJlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcuaXNDb25maWd1cmVkO1xuICB9XG5cbiAgcHVibGljIGdldFNlcnZpY2VOYW1lKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLnNlcnZpY2U7XG4gIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IGFpU2VydmljZSA9IG5ldyBBSVNlcnZpY2UoKTsiXSwibmFtZXMiOlsiQUlTZXJ2aWNlIiwibG9hZENvbmZpZyIsInN0YWJpbGl0eUtleSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVEFCSUxJVFlfQVBJX0tFWSIsInJlcGxpY2F0ZUtleSIsIk5FWFRfUFVCTElDX1JFUExJQ0FURV9BUElfS0VZIiwib3BlbmFpS2V5IiwiTkVYVF9QVUJMSUNfT1BFTkFJX0FQSV9LRVkiLCJzZXJ2aWNlIiwiYXBpS2V5IiwiZW5kcG9pbnQiLCJpc0NvbmZpZ3VyZWQiLCJnZXRTZXJ2aWNlQ29uZmlnIiwiZ2VuZXJhdGVGb3hQZXJzb24iLCJpbWFnZUJsb2IiLCJwcm9tcHQiLCJzdHJlbmd0aCIsImVycm9ycyIsImNvbmZpZyIsImNvbnNvbGUiLCJsb2ciLCJnZW5lcmF0ZVdpdGhTZXJ2aWNlIiwiZXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJFcnJvciIsIm1lc3NhZ2UiLCJTdHJpbmciLCJwdXNoIiwid2FybiIsImZhbGxiYWNrU2VydmljZXMiLCJzZXJ2aWNlQ29uZmlnIiwiZ2V0RGVtb0ltYWdlIiwiZGVtb0ltYWdlcyIsInJhbmRvbUltYWdlIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibGVuZ3RoIiwiZ2VuZXJhdGVXaXRoU3RhYmlsaXR5IiwiZ2VuZXJhdGVXaXRoUmVwbGljYXRlIiwiZ2VuZXJhdGVXaXRoT3BlbkFJIiwiZm9ybURhdGEiLCJGb3JtRGF0YSIsImFwcGVuZCIsInN0cmVuZ3RoVGV4dCIsImVuaGFuY2VkUHJvbXB0IiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJib2R5Iiwib2siLCJlcnJvclRleHQiLCJ0ZXh0Iiwic3RhdHVzIiwicmVzdWx0IiwianNvbiIsImFydGlmYWN0cyIsImJhc2U2NCIsImJsb2JUb0Jhc2U2NCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ2ZXJzaW9uIiwiaW5wdXQiLCJpbWFnZSIsIm91dHB1dCIsIm1vZGVsIiwibiIsInNpemUiLCJkYXRhIiwidXJsIiwiYmxvYiIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwicmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsInNwbGl0Iiwib25lcnJvciIsInJlYWRBc0RhdGFVUkwiLCJnZXRTZXJ2aWNlTmFtZSIsImNvbnN0cnVjdG9yIiwiYWlTZXJ2aWNlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(app-pages-browser)/./src/lib/ai-service.ts\n"));

/***/ })

});