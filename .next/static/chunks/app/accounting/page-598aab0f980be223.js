(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9450],{56826:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>D});var a=n(95155),r=n(12115),o=n(68931),l=n(90560),i=n(41088),c=n(83540),s=n(90170),d=n(18357),h=n(54811),u=n(27086),m=n(64683);let f=e=>{let{isMobile:t,paymentPercentNewPieData:n,paymentPercentOldPieData:r}=e;return(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-2",children:[(0,a.jsxs)("div",{className:"w-full bg-white rounded-xl shadow-lg mt-4 lg:mt-5",children:[(0,a.jsx)("div",{className:"text-lg lg:text-xl font-medium text-gray-700 text-center pt-6 lg:pt-10",children:"Tỉ lệ c\xe1c h\xecnh thức thanh to\xe1n ( kh\xe1ch mới )"}),(0,a.jsx)("div",{className:"flex justify-center items-center 18 lg:py-8",children:(0,a.jsx)(c.u,{width:"100%",height:t?220:300,minWidth:t?180:320,children:(0,a.jsxs)(s.r,{children:[(0,a.jsx)(d.F,{data:n,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:"30%",outerRadius:"60%",label:t?e=>{var t;let{percent:r,x:o,y:l,index:i}=e;if(!r||r<=0||"number"!=typeof i||i<0)return null;let c=(null==(t=n[i])?void 0:t.color)||"#333";return(0,a.jsx)("text",{x:o,y:l,textAnchor:"middle",dominantBaseline:"central",fontSize:10,fontWeight:600,fill:c,children:"".concat((100*r).toFixed(1),"%")})}:e=>{var t;let{percent:r,x:o,y:l,index:i}=e;if(!r||r<=0||"number"!=typeof i||i<0)return null;let c=(null==(t=n[i])?void 0:t.color)||"#333";return(0,a.jsx)("text",{x:o,y:l,textAnchor:"middle",dominantBaseline:"central",fontSize:14,fontWeight:600,fill:c,children:"".concat((100*r).toFixed(1),"%")})},labelLine:!1,children:n.map(e=>(0,a.jsx)(h.f,{fill:e.color},e.name))}),(0,a.jsx)(u.m,{formatter:(e,t,n)=>{var a;return"".concat(Number(e).toLocaleString()," (").concat(null==(a=n.payload.percent)?void 0:a.toFixed(2),"%)")}}),(0,a.jsx)(m.s,{wrapperStyle:{paddingTop:10,paddingBottom:10,display:"flex",justifyContent:"center",flexWrap:"wrap",width:"100%",fontSize:t?9:12},layout:"horizontal",verticalAlign:"bottom",align:"center"})]})})})]}),(0,a.jsxs)("div",{className:"w-full bg-white rounded-xl shadow-lg mt-4 lg:mt-5",children:[(0,a.jsx)("div",{className:"text-lg lg:text-xl font-medium text-gray-700 text-center pt-6 lg:pt-10",children:"Tỉ lệ c\xe1c h\xecnh thức thanh to\xe1n ( kh\xe1ch cũ )"}),(0,a.jsx)("div",{className:"flex justify-center items-center py-4 lg:py-8",children:(0,a.jsx)(c.u,{width:"100%",height:300,children:(0,a.jsxs)(s.r,{children:[(0,a.jsx)(d.F,{data:r,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:"30%",outerRadius:"60%",label:t?e=>{var t;let{percent:n,x:o,y:l,index:i}=e;if(!n||n<=0||"number"!=typeof i||i<0)return null;let c=(null==(t=r[i])?void 0:t.color)||"#333";return(0,a.jsx)("text",{x:o,y:l,textAnchor:"middle",dominantBaseline:"central",fontSize:10,fontWeight:600,fill:c,children:"".concat((100*n).toFixed(1),"%")})}:e=>{var t;let{percent:n,x:o,y:l,index:i}=e;if(!n||n<=0||"number"!=typeof i||i<0)return null;let c=(null==(t=r[i])?void 0:t.color)||"#333";return(0,a.jsx)("text",{x:o,y:l,textAnchor:"middle",dominantBaseline:"central",fontSize:14,fontWeight:600,fill:c,children:"".concat((100*n).toFixed(1),"%")})},labelLine:!1,children:r.map(e=>(0,a.jsx)(h.f,{fill:e.color},e.name))}),(0,a.jsx)(u.m,{}),(0,a.jsx)(m.s,{wrapperStyle:{paddingTop:10,paddingBottom:10,display:"flex",justifyContent:"center",flexWrap:"wrap",width:"100%",fontSize:t?9:12},layout:"horizontal",verticalAlign:"bottom",align:"center"})]})})})]})]})};var g=n(3401),x=n(94754),p=n(96025),y=n(52071),b=n(56690),j=n(36079);function S(e){let{paymentRegionData:t,isMobile:n}=e,o=r.useMemo(()=>{if(!t||0===t.length)return[{region:"Đang tải...",bank:0,cash:0,card:0,total:0},{region:"Đang tải...",bank:0,cash:0,card:0,total:0},{region:"Đang tải...",bank:0,cash:0,card:0,total:0},{region:"Đang tải...",bank:0,cash:0,card:0,total:0},{region:"Đang tải...",bank:0,cash:0,card:0,total:0}];let e=t.map(e=>({...e,total:(e.bank||0)+(e.cash||0)+(e.card||0)})).sort((e,t)=>e.total-t.total).slice(0,5);return console.log("Payment Region Data from API:",t),console.log("Bottom 5 Data:",e),e},[t]),l=r.useMemo(()=>{let e=new Map;return o.forEach(t=>{let n=[t.bank||0,t.cash||0,t.card||0];e.set(t.region,Math.max(...n))}),e},[o]);return(0,a.jsxs)("div",{className:"w-full bg-white rounded-xl shadow-lg mt-8 p-2 sm:p-4",children:[(0,a.jsx)("div",{className:"text-base sm:text-2xl font-semibold text-gray-800 mb-4",children:"H\xecnh thức thanh to\xe1n theo v\xf9ng"}),(0,a.jsx)("div",{className:"w-full overflow-x-auto",children:(0,a.jsx)(c.u,{width:"100%",height:n?250:350,minWidth:280,children:(0,a.jsxs)(g.E,{data:o,margin:{top:20,right:n?20:40,left:n?20:40,bottom:20},barCategoryGap:n?10:20,barGap:n?4:8,children:[(0,a.jsx)(x.d,{strokeDasharray:"3 3"}),(0,a.jsx)(p.W,{dataKey:"region",fontSize:n?10:12,angle:n?-45:0,textAnchor:n?"end":"middle",height:n?60:30}),(0,a.jsx)(y.h,{tickFormatter:e=>"number"==typeof e&&e>=1e6?(e/1e6).toFixed(1)+"M":"number"==typeof e?e.toLocaleString():e,fontSize:n?10:12,width:n?60:80}),(0,a.jsx)(u.m,{formatter:e=>"number"==typeof e?e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e.toLocaleString():e,contentStyle:{fontSize:n?12:14,backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #ccc",borderRadius:"4px",padding:"8px"}}),(0,a.jsx)(m.s,{wrapperStyle:{fontSize:n?10:12,paddingTop:n?10:20}}),(0,a.jsx)(b.y,{dataKey:"bank",name:"Chuyển khoản",fill:"#795548",maxBarSize:n?40:50,children:(0,a.jsx)(j.Z,{dataKey:"bank",position:"top",formatter:e=>{if("number"==typeof e&&0===e)return"";if(n){let t=o.find(t=>t.bank===e);if(!t)return"";let n=l.get(t.region)||0;return"number"==typeof e&&e===n&&e>0?(e/1e6).toFixed(1)+"M":""}return"number"==typeof e&&e>0?(e/1e6).toFixed(1)+"M":""},fill:"#795548",fontSize:n?10:12})}),(0,a.jsx)(b.y,{dataKey:"cash",name:"Tiền mặt",fill:"#c5e1a5",maxBarSize:n?40:50,children:(0,a.jsx)(j.Z,{dataKey:"cash",position:"top",formatter:e=>{if("number"==typeof e&&0===e)return"";if(n){let t=o.find(t=>t.cash===e);if(!t)return"";let n=l.get(t.region)||0;return"number"==typeof e&&e===n&&e>0?(e/1e6).toFixed(1)+"M":""}return"number"==typeof e&&e>0?(e/1e6).toFixed(1)+"M":""},fill:"#c5e1a5",fontSize:n?10:12})}),(0,a.jsx)(b.y,{dataKey:"card",name:"Thẻ t\xedn dụng/Ghi nợ",fill:"#ff7f7f",maxBarSize:n?40:50,children:(0,a.jsx)(j.Z,{dataKey:"card",position:"top",formatter:e=>{if("number"==typeof e&&0===e)return"";if(n){let t=o.find(t=>t.card===e);if(!t)return"";let n=l.get(t.region)||0;return"number"==typeof e&&e===n&&e>0?(e/1e6).toFixed(1)+"M":""}return"number"==typeof e&&e>0?(e/1e6).toFixed(1)+"M":""},fill:"#ff7f7f",fontSize:n?10:12})})]})})})]})}var w=n(37945),v=n(6044),N=n(17606);let T="https://cec2cc5ee186.ngrok-free.app";function k(e,t,n){let[a,o]=(0,r.useState)(null),[l,i]=(0,r.useState)(!0),[c,s]=(0,r.useState)(null);return(0,r.useEffect)(()=>{i(!0),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromDate:t,toDate:n})}).then(e=>{if(!e.ok)throw Error("API error: "+e.status);return e.json()}).then(e=>{o(e),i(!1)}).catch(e=>{s(e.message),i(!1)})},[e,t,n]),{data:a,loading:l,error:c}}function D(){let{notification:e,showSuccess:t,showError:n,hideNotification:c}=(0,w.h)(),s=(0,r.useRef)(!1),d=(0,r.useRef)(!1),{reportFilterChange:h,reportResetFilters:u}=(0,N.n)("accounting"),[m,g]=(0,v.V)("customer-selectedType",[]),[x,p]=(0,v.V)("customer-selectedStatus",null),[y,b]=(0,r.useState)(!1),[j,D]=(0,r.useState)(!1),[C,E]=(0,v.V)("customer-startDate",(0,o.Ec)((0,o.Xj)()).subtract({days:7})),[B,K]=(0,v.V)("customer-endDate",(0,o.Ec)((0,o.Xj)())),[R,z]=(0,v.V)("customer-selectedRegions",[]),[M,F]=(0,r.useState)(!1),[A,H]=(0,v.V)("customer-selectedBranches",[]),[P,V]=(0,r.useState)(!1),W=C?"".concat(C.year,"-").concat(String(C.month).padStart(2,"0"),"-").concat(String(C.day).padStart(2,"0"),"T00:00:00"):"",L=B?"".concat(B.year,"-").concat(String(B.month).padStart(2,"0"),"-").concat(String(B.day).padStart(2,"0"),"T23:59:59"):"",{data:O,loading:_,error:G}=k("".concat(T,"/api/customer-sale/customer-summary"),W,L),{data:I}=k("".concat(T,"/api/customer-sale/payment-percent-new"),W,L),{data:X}=k("".concat(T,"/api/customer-sale/payment-percent-old"),W,L),{data:Z,loading:U,error:Y}=k("".concat(T,"/api/sales/payment-by-region"),W,L),J=[_,U].some(e=>e),q=[G,Y].some(e=>e);(0,r.useEffect)(()=>{J||q||!O||s.current||(t("Dữ liệu kế to\xe1n đ\xe3 được tải th\xe0nh c\xf4ng!"),s.current=!0)},[J,q,O,t]),(0,r.useEffect)(()=>{q&&!d.current&&(n("Kh\xf4ng thể kết nối đến API. Vui l\xf2ng thử lại sau."),d.current=!0)},[q,n]),(0,r.useEffect)(()=>{m.length>0&&h("loại kh\xe1ch h\xe0ng: ".concat(m.join(", ")))},[m,h]),(0,r.useEffect)(()=>{x&&h("trạng th\xe1i: ".concat(x))},[x,h]),(0,r.useEffect)(()=>{R.length>0&&h("khu vực: ".concat(R.join(", ")))},[R,h]),(0,r.useEffect)(()=>{A.length>0&&h("chi nh\xe1nh: ".concat(A.join(", ")))},[A,h]);let Q=r.useMemo(()=>I?[{name:"TIỀN MẶT",value:I.totalCash||0,color:"#00d084"},{name:"CHUYỂN KHOẢN",value:I.totalTransfer||0,color:"#5bd1d7"},{name:"THẺ T\xcdN DỤNG",value:I.totalCreditCard||0,color:"#ff7f7f"},{name:"THẺ TRẢ TRƯỚC",value:I.totalPrepaidCard||0,color:"#f66035"},{name:"C\xd2N NỢ",value:I.totalDebt||0,color:"#eb94cf"}].filter(e=>e.value>0):[],[I]),$=r.useMemo(()=>X?[{name:"TIỀN MẶT",value:X.totalCash||0,color:"#00d084"},{name:"CHUYỂN KHOẢN",value:X.totalTransfer||0,color:"#5bd1d7"},{name:"THẺ T\xcdN DỤNG",value:X.totalCreditCard||0,color:"#ff7f7f"},{name:"THẺ TRẢ TRƯỚC",value:X.totalPrepaidCard||0,color:"#f66035"},{name:"C\xd2N NỢ",value:X.totalDebt||0,color:"#eb94cf"}].filter(e=>e.value>0):[],[X]),ee=r.useMemo(()=>Z?Z.map(e=>({region:e.region,bank:e.transfer||0,cash:e.cash||0,card:e.creditCard||0})).filter(e=>e.bank+e.cash+e.card>0):[],[Z]),et=640>function(){let[e,t]=(0,r.useState)(1024);return(0,r.useEffect)(()=>{function e(){t(window.innerWidth)}return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}();return(0,a.jsxs)("div",{className:"p-2 sm:p-4 md:p-6 max-w-full",children:[(0,a.jsx)(w.E,{type:e.type,message:e.message,isVisible:e.isVisible,onClose:c}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"p-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("h1",{className:"text-xl lg:text-2xl font-semibold text-gray-900",children:"Accounting Report"}),(0,a.jsx)("button",{onClick:()=>{(0,v.e)(["customer-selectedType","customer-selectedStatus","customer-startDate","customer-endDate","customer-selectedRegions","customer-selectedBranches"]),g([]),p(null),E((0,o.Ec)((0,o.Xj)()).subtract({days:7})),K((0,o.Ec)((0,o.Xj)())),z([]),H([]),t("Đ\xe3 reset tất cả filter về mặc định!"),u()},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm",children:"Reset Filters"})]}),(0,a.jsx)(i.A,{startDate:C,endDate:B,setStartDate:E,setEndDate:K,today:o.Ec,getLocalTimeZone:o.Xj,parseDate:l._U,selectedType:m,setSelectedType:g,showTypeDropdown:y,setShowTypeDropdown:b,customerTypes:["KH trải nghiệm","Kh\xe1ch h\xe0ng Th\xe0nh vi\xean","Kh\xe1ch h\xe0ng Bạc","Kh\xe1ch h\xe0ng V\xe0ng","Kh\xe1ch h\xe0ng Bạch Kim","Kh\xe1ch h\xe0ng Kim cương"],selectedStatus:x,setSelectedStatus:p,showStatusDropdown:j,setShowStatusDropdown:D,customerStatus:["New","Old"],selectedRegions:R,setSelectedRegions:z,showRegionDropdown:M,setShowRegionDropdown:F,allRegions:["Đ\xe3 đ\xf3ng cửa","Đ\xe0 Nẵng","Nha Trang","H\xe0 Nội","HCM"],selectedBranches:A,setSelectedBranches:H,showBranchDropdown:P,setShowBranchDropdown:V,allBranches:["Branch 1","Branch 2","Branch 3"]}),(0,a.jsx)(f,{isMobile:et,paymentPercentNewPieData:Q,paymentPercentOldPieData:$})]}),(0,a.jsx)(S,{paymentRegionData:ee,isMobile:et})]})]})}},81958:(e,t,n)=>{Promise.resolve().then(n.bind(n,56826))}},e=>{var t=t=>e(e.s=t);e.O(0,[5156,6939,1932,8262,5464,1862,8441,1684,7358],()=>t(81958)),_N_E=e.O()}]);