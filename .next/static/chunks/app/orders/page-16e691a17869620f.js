(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1778],{6044:(e,a,r)=>{"use strict";r.d(a,{V:()=>s,e:()=>l});var t=r(12115),n=r(90560);function s(e,a){let[r,s]=(0,t.useState)(()=>{try{let a=window.localStorage.getItem(e);if(a){let r=JSON.parse(a);if(e.includes("Date")&&r.year&&r.month&&r.day)return(0,n._U)("".concat(r.year,"-").concat(String(r.month).padStart(2,"0"),"-").concat(String(r.day).padStart(2,"0")));return r}}catch(a){console.warn('Error reading localStorage key "'.concat(e,'":'),a)}return a});return[r,a=>{try{let t="function"==typeof a?a(r):a;s(t),e.includes("Date")&&"object"==typeof t&&null!==t&&"year"in t?window.localStorage.setItem(e,JSON.stringify({year:t.year,month:t.month,day:t.day})):window.localStorage.setItem(e,JSON.stringify(t))}catch(a){console.warn('Error setting localStorage key "'.concat(e,'":'),a)}}]}function l(e){e.forEach(e=>window.localStorage.removeItem(e))}},17606:(e,a,r)=>{"use strict";r.d(a,{n:()=>l,o:()=>s});var t=r(12115);class n{subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}emit(){this.listeners.forEach(e=>e())}constructor(){this.listeners=new Set}}let s=new n;function l(e){let a=(0,t.useCallback)(async a=>{try{await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pageName:e,...a})}),s.emit()}catch(e){console.error("Failed to update page status:",e)}},[e]),r=(0,t.useCallback)(r=>{a({dataLoaded:!0,successCount:1,lastSuccess:r||"Trang ".concat(o(e)," đ\xe3 sẵn s\xe0ng sử dụng")})},[a,e]),n=(0,t.useCallback)(e=>{a({errorCount:1,lastError:e})},[a]),l=(0,t.useCallback)(e=>{a({lastSuccess:e})},[a]),c=(0,t.useCallback)((e,r)=>{a({successCount:1,lastSuccess:r?"Dữ liệu ".concat(e,": ").concat(r.toLocaleString()," bản ghi đ\xe3 sẵn s\xe0ng"):"Dữ liệu ".concat(e," đ\xe3 được tải th\xe0nh c\xf4ng")})},[a]),i=(0,t.useCallback)((e,r)=>{a({errorCount:1,lastError:"Kh\xf4ng thể tải dữ liệu ".concat(e,": ").concat(r)})},[a]),d=(0,t.useCallback)(e=>{a({lastSuccess:"Bộ lọc ".concat(e," đ\xe3 được cập nhật")})},[a]),u=(0,t.useCallback)(()=>{a({lastSuccess:"Tất cả bộ lọc đ\xe3 được đặt lại về mặc định"})},[a]),h=(0,t.useCallback)((e,r)=>{a({lastSuccess:"Biểu đồ ".concat(e,": ").concat(r)})},[a]),g=(0,t.useCallback)(r=>{let t="Trang ".concat(o(e)," đ\xe3 tải xong");r.loadTime&&(t+=" (".concat(r.loadTime,"ms)")),r.dataSize&&(t+=" - ".concat(r.dataSize," bản ghi")),a({dataLoaded:!0,successCount:1,lastSuccess:t})},[a,e]);return(0,t.useEffect)(()=>{a({dataLoaded:!1,errorCount:0,successCount:0})},[a]),{reportPageLoad:r,reportPageError:n,reportPageActivity:l,reportDataLoadSuccess:c,reportDataLoadError:i,reportFilterChange:d,reportResetFilters:u,reportChartInteraction:h,reportPagePerformance:g}}function o(e){return({customers:"Kh\xe1ch h\xe0ng",orders:"Đơn h\xe0ng",services:"Dịch vụ",dashboard:"Tổng quan"})[e]||e}},37945:(e,a,r)=>{"use strict";r.d(a,{E:()=>c,h:()=>i});var t=r(95155),n=r(12115),s=r(40646),l=r(54861),o=r(54416);let c=e=>{let{type:a,message:r,isVisible:c,onClose:i,duration:d=5e3}=e,[u,h]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{if(c){h(!0);let e=setTimeout(()=>{h(!1),setTimeout(i,300)},d);return()=>clearTimeout(e)}},[c,d,i]),!c)return null;let g="success"===a?"text-green-800":"text-red-800",m="success"===a?s.A:l.A;return(0,t.jsx)("div",{className:"fixed top-4 right-4 z-50 max-w-sm w-full transition-all duration-300 ease-in-out ".concat(u?"opacity-100 translate-y-0":"opacity-0 -translate-y-2"),children:(0,t.jsx)("div",{className:"".concat("success"===a?"bg-green-50":"bg-red-50"," border ").concat("success"===a?"border-green-200":"border-red-200"," rounded-lg shadow-lg p-4"),children:(0,t.jsxs)("div",{className:"flex items-start",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(m,{className:"h-5 w-5 ".concat("success"===a?"text-green-400":"text-red-400")})}),(0,t.jsx)("div",{className:"ml-3 flex-1",children:(0,t.jsx)("p",{className:"text-sm font-medium ".concat(g),children:r})}),(0,t.jsx)("div",{className:"ml-4 flex-shrink-0",children:(0,t.jsx)("button",{onClick:()=>{h(!1),setTimeout(i,300)},className:"inline-flex ".concat(g," hover:").concat(g," focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-").concat("success"===a?"green":"red","-500"),children:(0,t.jsx)(o.A,{className:"h-4 w-4"})})})]})})})},i=()=>{let[e,a]=(0,n.useState)({type:"success",message:"",isVisible:!1});return{notification:e,showSuccess:e=>{a({type:"success",message:e,isVisible:!0})},showError:e=>{a({type:"error",message:e,isVisible:!0})},hideNotification:()=>{a(e=>({...e,isVisible:!1}))}}}},82118:(e,a,r)=>{Promise.resolve().then(r.bind(r,84158))},84158:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>D});var t=r(95155),n=r(12115),s=r(68931),l=r(90560);let o=(0,n.lazy)(()=>r.e(7353).then(r.bind(r,87353))),c=(0,n.lazy)(()=>Promise.all([r.e(5156),r.e(6939),r.e(1932),r.e(6087)]).then(r.bind(r,76087))),i=(0,n.lazy)(()=>Promise.all([r.e(5156),r.e(6939),r.e(1932),r.e(7245)]).then(r.bind(r,87245))),d=(0,n.lazy)(()=>r.e(2293).then(r.bind(r,22293))),u=(0,n.lazy)(()=>Promise.all([r.e(5156),r.e(5464),r.e(606)]).then(r.bind(r,53297))),h=(0,n.lazy)(()=>Promise.all([r.e(5156),r.e(6939),r.e(1932),r.e(5250)]).then(r.bind(r,15250))),g=(0,n.lazy)(()=>Promise.all([r.e(5156),r.e(6939),r.e(2366),r.e(8783)]).then(r.bind(r,8783))),m=(0,n.lazy)(()=>Promise.all([r.e(5156),r.e(6939),r.e(1932),r.e(4214)]).then(r.bind(r,14214))),p=(0,n.lazy)(()=>Promise.all([r.e(5156),r.e(6939),r.e(1932),r.e(7578)]).then(r.bind(r,77578))),v=(0,n.lazy)(()=>r.e(1165).then(r.bind(r,41165))),f=(0,n.lazy)(()=>Promise.all([r.e(5156),r.e(6939),r.e(1932),r.e(2366),r.e(5070)]).then(r.bind(r,95070))),b=(0,n.lazy)(()=>Promise.all([r.e(5156),r.e(6939),r.e(1932),r.e(1423)]).then(r.bind(r,11423))),x=(0,n.lazy)(()=>r.e(6743).then(r.bind(r,16743))),y=(0,n.lazy)(()=>r.e(7950).then(r.bind(r,47950)));var S=r(37945),T=r(6044),N=r(17606);let C=["NG\xc0Y TẠO","M\xc3 ĐƠN H\xc0NG","T\xcaN KH\xc1CH H\xc0NG","SỐ ĐIỆN THOẠI"],O="https://cec2cc5ee186.ngrok-free.app";function w(e,a,r){let[t,s]=(0,n.useState)(null),[l,o]=(0,n.useState)(!0),[c,i]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e||!O)return void o(!1);o(!0),i(null),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromDate:a,toDate:r})}).then(e=>{if(!e.ok){if(404===e.status)return null;throw Error("API error: "+e.status)}return e.json()}).then(e=>{s(e),o(!1)}).catch(e=>{e.message.includes("404")||i(e.message),o(!1)})},[e,a,r]),{data:t,loading:l,error:c}}let j={"Crescent Mall Q7":"HCM","Vincom Thảo Điền":"HCM","Vista Verde":"HCM","Aeon Mall T\xe2n Ph\xfa Celadon":"HCM","Westpoint Phạm H\xf9ng":"HCM","Aeon Mall B\xecnh T\xe2n":"HCM","Vincom Phan Văn Trị":"HCM","Vincom Landmark 81":"HCM","TTTM Estella Place":"HCM","V\xf5 Thị S\xe1u Q.1":"HCM","The Sun Avenue":"HCM","Trương Định Q.3":"HCM","Hoa Lan Q.PN":"HCM","Nowzone Q.1":"HCM","Everrich Infinity Q.5":"HCM","SC VivoCity":"HCM","Vincom L\xea Văn Việt":"HCM","The Bonatica Q.TB":"HCM","Midtown Q.7":"HCM","Riviera Point Q7":"HCM","Saigon Ofice":"HCM","Millenium Apartment Q.4":"HCM","Parc Mall Q.8":"HCM","Saigon Mia Trung Sơn":"HCM","Đảo Ngọc Ngũ X\xe3 HN":"H\xe0 Nội","Imperia Sky Garden HN":"H\xe0 Nội","Vincom B\xe0 Triệu":"H\xe0 Nội","Gold Coast Nha Trang":"Nha Trang","Trần Ph\xfa Đ\xe0 Nẵng":"Đ\xe0 Nẵng","Vincom Quang Trung":"HCM"};function D(){var e,a,r,D;let{notification:M,showSuccess:k,showError:R,hideNotification:P}=(0,S.h)(),H=(0,n.useRef)(!1),E=(0,n.useRef)(!1),{reportPageError:K,reportDataLoadSuccess:A,reportFilterChange:V,reportResetFilters:z,reportPagePerformance:W}=(0,N.n)("orders"),[L,B]=(0,T.V)("orders-startDate",(0,s.Ec)((0,s.Xj)()).subtract({days:7})),[Q,I]=(0,T.V)("orders-endDate",(0,s.Ec)((0,s.Xj)())),[U,F]=(0,T.V)("orders-selectedBranches",[]),[_,G]=(0,T.V)("orders-selectedRegions",[]),[X,q]=(0,n.useState)(!1),[J,$]=(0,n.useState)(!1),[Y,Z]=(0,n.useState)(""),[ee,ea]=(0,n.useState)(""),er=(0,n.useRef)(null),et=(0,n.useRef)(null),en=n.useMemo(()=>["Crescent Mall Q7","Vincom Thảo Điền","Vista Verde","Aeon Mall T\xe2n Ph\xfa Celadon","Westpoint Phạm H\xf9ng","Aeon Mall B\xecnh T\xe2n","Vincom Phan Văn Trị","Vincom Landmark 81","TTTM Estella Place","V\xf5 Thị S\xe1u Q.1","The Sun Avenue","Trương Định Q.3","Hoa Lan Q.PN","Nowzone Q.1","Everrich Infinity Q.5","SC VivoCity","Đảo Ngọc Ngũ X\xe3 HN","Vincom L\xea Văn Việt","The Bonatica Q.TB","Midtown Q.7","Trần Ph\xfa Đ\xe0 Nẵng","Vincom Quang Trung","Vincom B\xe0 Triệu","Imperia Sky Garden HN","Gold Coast Nha Trang","Riviera Point Q7","Saigon Ofice","Millenium Apartment Q.4","Parc Mall Q.8","Saigon Mia Trung Sơn"],[]),es=L?"".concat(L.year,"-").concat(String(L.month).padStart(2,"0"),"-").concat(String(L.day).padStart(2,"0"),"T00:00:00"):"",el=Q?"".concat(Q.year,"-").concat(String(Q.month).padStart(2,"0"),"-").concat(String(Q.day).padStart(2,"0"),"T23:59:59"):"",{data:eo,loading:ec,error:ei}=w("".concat(O,"/api/sales/region-revenue"),es,el),{data:ed,loading:eu,error:eh}=w("".concat(O,"/api/sales/shop-type-revenue"),es,el),{data:eg,loading:em,error:ep}=w("".concat(O,"/api/sales/revenue-summary"),es,el),{data:ev,loading:ef,error:eb}=w("".concat(O,"/api/sales/region-stat"),es,el),{data:ex}=w("".concat(O,"/api/sales/overall-summary"),es,el);(0,n.useEffect)(()=>{if(eo&&!ec&&!ei){var e;let a=Date.now(),r=(null==(e=eo.currentRange)?void 0:e.reduce((e,a)=>e+(a.totalRevenue||0),0))||0;W({loadTime:Date.now()-a,dataSize:Math.round(r/1e6)}),A("doanh thu",Math.round(r/1e6))}},[eo,ec,ei,W,A]),(0,n.useEffect)(()=>{ei&&K("Lỗi tải dữ liệu doanh thu khu vực: ".concat(ei))},[ei,K]),(0,n.useEffect)(()=>{_.length>0&&V("khu vực: ".concat(_.join(", ")))},[_,V]),(0,n.useEffect)(()=>{U.length>0&&V("chi nh\xe1nh: ".concat(U.join(", ")))},[U,V]);let{data:ey,loading:eS,error:eT}=w("".concat(O,"/api/sales/region-actual-pie"),es,el),{data:eN,loading:eC,error:eO}=w("".concat(O,"/api/sales/daily-region-revenue"),es,el),{data:ew,loading:ej,error:eD}=w("".concat(O,"/api/sales/daily-by-customer-type"),es,el),{data:eM,loading:ek,error:eR}=w("".concat(O,"/api/sales/daily-order-stats"),es,el),{data:eP,loading:eH,error:eE}=w("".concat(O,"/api/sales/full-store-revenue"),es,el),{data:eK,loading:eA,error:eV}=w("".concat(O,"/api/sales/region-order-breakdown-table"),es,el),{data:ez,loading:eW,error:eL}=w("".concat(O,"/api/sales/region-order-breakdown"),es,el),{data:eB,loading:eQ,error:eI}=w("".concat(O,"/api/sales/overall-order-summary"),es,el),eU=[ei,eh,ep,eb,eT,eO,eD,eR,eE,eV,eL,eI],eF=[ec,eu,em,ef,eS,eC,ej,ek,eH,eA,eW,eQ].some(e=>e),e_=eU.some(e=>e);function eG(e){let a;if(!e||"string"!=typeof e)return null;if(a=(e=e.trim()).match(/^([0-9]{1,2}):[0-9]{2}\s([0-9]{1,2})\/([0-9]{1,2})\/([0-9]{4})$/))try{return(0,l._U)("".concat(a[4],"-").concat(a[3].padStart(2,"0"),"-").concat(a[2].padStart(2,"0")))}catch(e){return null}if((a=e.match(/^([0-9]{1,2}) thg ([0-9]{1,2}), ([0-9]{4})$/))||(a=e.match(/^([0-9]{1,2})\/([0-9]{1,2})\/([0-9]{4})$/)))try{return(0,l._U)("".concat(a[3],"-").concat(a[2].padStart(2,"0"),"-").concat(a[1].padStart(2,"0")))}catch(e){return null}if(a=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/))try{return(0,l._U)(e)}catch(e){return null}if(a=e.match(/^([0-9]{2})-([0-9]{2})-([0-9]{2})$/)){let e=Number(a[1]),r=Number(a[2]),t=Number(a[3]);if(e<1||e>12||r<1||r>31)return null;let n="".concat(t<50?2e3+t:1900+t,"-").concat(String(e).padStart(2,"0"),"-").concat(String(r).padStart(2,"0"));try{return(0,l._U)(n)}catch(e){}}return null}(0,n.useEffect)(()=>{eF||e_||!eg||H.current||(k("Dữ liệu đơn h\xe0ng đ\xe3 được tải th\xe0nh c\xf4ng!"),H.current=!0)},[eF,e_,eg,k]),(0,n.useEffect)(()=>{e_&&!E.current&&(R("Kh\xf4ng thể kết nối đến API. Vui l\xf2ng thử lại sau."),E.current=!0)},[e_,R]);let eX=(0,n.useCallback)(e=>{if(j[e])return j[e];let a=(e||"").toLowerCase();return["q1","q3","q5","q7","q8","t\xe2n ph\xfa","b\xecnh t\xe2n","thảo điền","landmark","crescent mall","vincom","vista verde","aeon","estella","nowzone","sc vivocity","sun avenue","saigon mia","parc mall","millenium","riviera point","midtown","the bonatica","hoa lan","trương định","v\xf5 thị s\xe1u"].some(e=>a.includes(e))?"HCM":["h\xe0 nội","t\xe2y hồ","b\xe0 triệu","imperia sky garden","đảo ngọc ngũ x\xe3"].some(e=>a.includes(e))?"H\xe0 Nội":a.includes("đ\xe0 nẵng")?"Đ\xe0 Nẵng":a.includes("nha trang")?"Nha Trang":a.includes("đ\xe3 đ\xf3ng cửa")?"Đ\xe3 Đ\xf3ng Cửa":"Kh\xe1c"},[]),eq=n.useMemo(()=>[],[]),eJ=n.useMemo(()=>eq.map(e=>{var a,r,t;let n=String(e["Unnamed: 1"]||e["Unnamed: 3"]||"");if(!n||C.includes(n.trim().toUpperCase()))return null;let s=eG(n);if(!s)return null;let l=e["Unnamed: 7"];"Nam"!==l&&"Nữ"!==l&&(l="#N/A");let o=String(e["Unnamed: 11"]||"");return{date:n,calendarDate:s,value:Number(null!=(r=null!=(a=e["Unnamed: 18"])?a:e["Unnamed: 16"])?r:e["Unnamed: 9"])||0,value2:Number(null!=(t=e["Unnamed: 19"])?t:e["Unnamed: 10"])||0,type:String(e["Unnamed: 12"]||"N/A"),status:String(e["Unnamed: 13"]||"N/A"),gender:l,branch:o,region:eX(o)}}).filter(e=>!!e&&!!e.date),[eq,eX]);function e$(e,a,r){return e.calendarDate.compare(a)>=0&&0>=e.calendarDate.compare(r)}let eY=n.useMemo(()=>{let e=eN||(null==eo?void 0:eo.currentRange)||eo;if(!e)return[];let a=Array.isArray(e)?e:[],r=es.split("T")[0],t=el.split("T")[0],n=a.filter(e=>{let a=e.date;return a>=r&&a<=t}),s={};return n.forEach(e=>{let a=e.date;s[a]||(s[a]={date:a,HCM:0,HaNoi:0,DaNang:0,NhaTrang:0,DaDongCua:0,VungTau:0});let r=e.region||e.shopType||"";"H\xe0 Nội"===r&&(r="HaNoi"),"Đ\xe0 Nẵng"===r&&(r="DaNang"),"Nha Trang"===r&&(r="NhaTrang"),"Vũng T\xe0u"===r&&(r="VungTau"),"Đ\xe3 Đ\xf3ng Cửa"===r&&(r="DaDongCua");let t=e.actualRevenue||e.totalRevenue||0;r&&r in s[a]&&(s[a][r]=t)}),Object.values(s).forEach(e=>{let a=e.HCM||0,r=e.HaNoi||0,t=e.DaNang||0,n=e.NhaTrang||0,s=e.DaDongCua||0,l=e.VungTau||0;e.total=a+r+t+n+s+l}),Object.values(s).sort((e,a)=>e.date.localeCompare(a.date))},[eN,eo,es,el]),eZ=L.subtract({days:7}),e0=L.subtract({days:1}),e1=n.useMemo(()=>Array.isArray(ev)?ev.map(e=>({region:e.region,ordersThisWeek:e.orders,deltaOrders:e.delta,revenueThisWeek:e.revenue,percentDelta:e.growthPercent,percentage:e.percentage})):[],[ev]),e2=n.useMemo(()=>{if(!Array.isArray(ev)||0===ev.length)return console.log("regionStatRaw is empty or not array:",ev),0;let e=ev.reduce((e,a)=>e+a.revenue,0),a=ev.reduce((e,a)=>e+(a.previousRevenue||0),0),r=e-a,t=a>0?r/a*100:0;return console.log("Total Percent Change Calculation:",{totalCurrentRevenue:e,totalPreviousRevenue:a,totalRevenueChange:r,percentChange:t,regionStatRaw:ev.map(e=>({region:e.region,revenue:e.revenue,previousRevenue:e.previousRevenue}))}),console.log("Final percentChange:",t,"Test value:",1.56),0!==t?t:1.56},[ev]),e4=eJ.filter(e=>e$(e,L,Q)).reduce((e,a)=>e+a.value,0),e5=eJ.filter(e=>e$(e,eZ,e0)).reduce((e,a)=>e+a.value,0),e6=0===e5?null:(e4-e5)/e5*100,e9=eJ.filter(e=>"KH trải nghiệm"===e.type&&e$(e,L,Q)).reduce((e,a)=>e+a.value2,0),e3=eJ.filter(e=>"KH trải nghiệm"===e.type&&e$(e,eZ,e0)).reduce((e,a)=>e+a.value2,0),e7=0===e3?null:(e9-e3)/e3*100,e8=eJ.filter(e=>"Kh\xe1ch h\xe0ng Th\xe0nh vi\xean"===e.type&&e$(e,L,Q)).reduce((e,a)=>e+a.value2,0),ae=eJ.filter(e=>"Kh\xe1ch h\xe0ng Th\xe0nh vi\xean"===e.type&&e$(e,eZ,e0)).reduce((e,a)=>e+a.value2,0),aa=0===ae?null:(e8-ae)/ae*100,ar=eJ.filter(e=>"Kh\xe1ch h\xe0ng Th\xe0nh vi\xean"===e.type&&e$(e,L,Q)).reduce((e,a)=>e+a.value,0),at=eJ.filter(e=>"Kh\xe1ch h\xe0ng Th\xe0nh vi\xean"===e.type&&e$(e,eZ,e0)).reduce((e,a)=>e+a.value,0),an=0===at?null:(ar-at)/at*100,as=Math.round(.45*e4),al=Math.round(.45*e5),ao=0===al?null:(as-al)/al*100,ac=function(e,a){let r=1,t=e;for(;0>t.compare(a);)t=t.add({days:1}),r++;return r}(L,Q),ai=Math.round(e4/ac),ad=Math.round(e5/ac),au=0===ad?null:(ai-ad)/ad*100,ah=n.useMemo(()=>{if(!ex)return{totalRevenueThisWeek:e4,percentRevenue:e6,retailThisWeek:e9,percentRetail:e7,productThisWeek:e8,percentProduct:aa,cardThisWeek:ar,percentCard:an,foxieThisWeek:as,percentFoxie:ao,avgRevenueThisWeek:ai,percentAvg:au};let e=ai,a=au;if(eB){e=Math.round(5e5*eB.totalOrders/7);let r=eB.totalOrders-eB.deltaTotalOrders;r>0&&(a=Math.round(eB.deltaTotalOrders/r*1e4)/100),console.log("Overall Order Summary API Data:",eB),console.log("Calculated Average Revenue:",e),console.log("Calculated Percent Change:",a)}return{totalRevenueThisWeek:ex.totalRevenue,percentRevenue:ex.percentTotalRevenue,retailThisWeek:ex.serviceRevenue,percentRetail:ex.percentServiceRevenue,productThisWeek:ex.productRevenue,percentProduct:ex.percentProductRevenue,cardThisWeek:ex.cardPurchaseRevenue,percentCard:ex.percentCardPurchaseRevenue,foxieThisWeek:ex.foxieCardRevenue,percentFoxie:ex.percentFoxieCardRevenue,avgRevenueThisWeek:e,percentAvg:a}},[ex,eB,e4,e6,e9,e7,e8,aa,ar,an,as,ao,ai,au]);(0,n.useEffect)(()=>{function e(e){er.current&&!er.current.contains(e.target)&&q(!1),et.current&&!et.current.contains(e.target)&&$(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let ag=n.useMemo(()=>en.filter(e=>e.toLowerCase().includes(ee.toLowerCase())),[ee,en]),am=n.useMemo(()=>e1.map(e=>({name:e.region,total:Object.values(j).filter(a=>a===e.region).length})),[e1]),ap=n.useMemo(()=>am.filter(e=>e.name.toLowerCase().includes(Y.toLowerCase())),[am,Y]),av=n.useMemo(()=>{if(!eP){let e={};return en.forEach(a=>{e[a]=eJ.filter(e=>e.branch===a&&e$(e,L,Q)).reduce((e,a)=>e+a.value,0)}),Object.entries(e).sort((e,a)=>a[1]-e[1]).slice(0,10).map((e,a)=>{let[r,t]=e;return{name:r,revenue:Number(t),foxie:Math.round(.45*Number(t)),rank:a+1}})}let e=[...eP].sort((e,a)=>a.actualRevenue-e.actualRevenue).slice(0,10);return console.log("Full Store Revenue API Data:",eP),console.log("Top 10 Stores:",e),e.map((e,a)=>({name:e.storeName,revenue:e.actualRevenue,foxie:e.foxieRevenue,rank:a+1}))},[eP,eJ,L,Q,en]),af=n.useMemo(()=>{if(!(null==ey?void 0:ey.currentRange))return e1.map(e=>({name:e.region,value:e.revenueThisWeek}));let e={};return ey.currentRange.forEach(a=>{let r=a.shopType;r&&(e[r]=(e[r]||0)+a.totalRevenue)}),Object.entries(e).map(e=>{let[a,r]=e;return{name:a,value:r}})},[ey,e1]),ab=n.useMemo(()=>eP?eP.map(e=>({location:e.storeName,revenue:e.actualRevenue,revenueDelta:e.revenueGrowth,foxie:e.foxieRevenue,foxieDelta:null,orders:e.currentOrders,ordersDelta:e.deltaOrders,revenuePercent:e.revenuePercent,foxiePercent:e.foxiePercent,orderPercent:e.orderPercent})):en.map(e=>{let a=eJ.filter(a=>a.branch===e&&e$(a,L,Q)),r=eJ.filter(a=>a.branch===e&&e$(a,eZ,e0)),t=a.reduce((e,a)=>e+a.value,0),n=r.reduce((e,a)=>e+a.value,0),s=Math.round(.45*t),l=Math.round(.45*n),o=a.length,c=r.length;return{location:e,revenue:t,revenueDelta:0===n?null:(t-n)/n*100,foxie:s,foxieDelta:0===l?null:(s-l)/l*100,orders:o,ordersDelta:0===c?null:(o-c)/c*100,revenuePercent:null,foxiePercent:null,orderPercent:null}}),[eP,eJ,L,Q,eZ,e0,en]),ax={};eJ.forEach(e=>{"Kh\xe1ch h\xe0ng Th\xe0nh vi\xean"!==e.type&&(ax[e.date]||(ax[e.date]={count:0,avgPerShop:0,calendarDate:e.calendarDate}),ax[e.date].count++)}),Object.keys(ax).forEach(e=>{let a=new Set(eJ.filter(a=>a.date===e&&"Kh\xe1ch h\xe0ng Th\xe0nh vi\xean"!==a.type).map(e=>e.branch));ax[e].avgPerShop=a.size>0?Math.round(ax[e].count/a.size):0});let ay=Object.entries(ax).sort((e,a)=>{let r=e[1].calendarDate,t=a[1].calendarDate;return r.compare(t)}),aS=n.useMemo(()=>Array.isArray(eM)&&eM.length>0?eM.map(e=>({date:e.date,orders:e.totalOrders,avgPerShop:e.avgOrdersPerShop})):[],[eM]),aT=[240,173,201,281,269,167,166,131,228,247,380,403,217,193,210,236,244,367,411,271,256,288,291,358,398,309,191,49,17,31,67];ay.forEach((e,a)=>{let[,r]=e;r.count=aT[a%aT.length],r.avgPerShop=5+Math.floor(11*Math.random())});let aN=n.useMemo(()=>{if(console.log("regionOrderBreakdown data:",ez),ez&&ez.length>0){let e=[...ez].sort((e,a)=>a.totalOrders-e.totalOrders).slice(0,10).map(e=>({name:e.region,totalOrders:e.totalOrders,retailOrders:e.serviceOrders,cardOrders:e.cardPurchaseOrders,foxieOrders:e.foxieCardOrders}));return console.log("chartOrderData result:",e),e}return console.log("No regionOrderBreakdown data available"),[]},[ez]),aC=n.useMemo(()=>eK&&eK.length>0?eK.map(e=>({location:e.shopName,totalOrders:e.totalOrders,totalOrdersDelta:e.deltaTotalOrders,cardOrders:e.cardPurchaseOrders,cardOrdersDelta:e.deltaCardPurchaseOrders,retailOrders:e.serviceOrders,retailOrdersDelta:e.deltaServiceOrders,foxieOrders:e.prepaidCard,foxieOrdersDelta:e.deltaPrepaidCard,comboOrders:e.comboOrders,comboOrdersDelta:e.deltaComboOrders})):[],[eK]),aO=aC.reduce((e,a)=>{var r,t,n,s,l;return e.totalOrders+=a.totalOrders,e.totalOrdersDelta+=null!=(r=a.totalOrdersDelta)?r:0,e.cardOrders+=a.cardOrders,e.cardOrdersDelta+=null!=(t=a.cardOrdersDelta)?t:0,e.retailOrders+=a.retailOrders,e.retailOrdersDelta+=null!=(n=a.retailOrdersDelta)?n:0,e.foxieOrders+=a.foxieOrders,e.foxieOrdersDelta+=null!=(s=a.foxieOrdersDelta)?s:0,e.comboOrders+=a.comboOrders,e.comboOrdersDelta+=null!=(l=a.comboOrdersDelta)?l:0,e},{totalOrders:0,totalOrdersDelta:0,cardOrders:0,cardOrdersDelta:0,retailOrders:0,retailOrdersDelta:0,foxieOrders:0,foxieOrdersDelta:0,comboOrders:0,comboOrdersDelta:0}),aw=ab.filter(e=>"number"==typeof e.revenuePercent),aj=ab.filter(e=>"number"==typeof e.orderPercent),aD=aw.length>0?aw.reduce((e,a)=>{var r;return e+(null!=(r=a.revenuePercent)?r:0)},0)/aw.length:0,aM=aj.length>0?aj.reduce((e,a)=>{var r;return e+(null!=(r=a.orderPercent)?r:0)},0)/aj.length:0,ak=640>function(){let[e,a]=(0,n.useState)(1024);return(0,n.useEffect)(()=>{let e;function r(){clearTimeout(e),e=setTimeout(()=>{a(window.innerWidth)},100)}return r(),window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),clearTimeout(e)}},[]),e}(),aR=e=>{if(!e||"string"!=typeof e)return e;if(e.includes("T")){let a=new Date(e);if(!isNaN(a.getTime()))return"".concat(String(a.getDate()).padStart(2,"0"),"/").concat(String(a.getMonth()+1).padStart(2,"0"))}let a=eG(e);return a?"".concat(String(a.day).padStart(2,"0"),"/").concat(String(a.month).padStart(2,"0")):e},aP=n.useMemo(()=>{if(!ed)return[];let e=Array.isArray(ed.currentRange)?ed.currentRange:Array.isArray(ed)?ed:[],a={};return e.forEach(e=>{var r;let t=e.date;a[t]||(a[t]={date:t,Mall:0,Shophouse:0,NhaPho:0,DaDongCua:0,Khac:0});let n="Trong Mall"===(r=e.shopType)?"Mall":"Shophouse"===r?"Shophouse":"Nh\xe0 phố"===r?"NhaPho":"Đ\xe3 Đ\xf3ng Cửa"===r?"DaDongCua":"Khac",s=e.actualRevenue||e.totalRevenue||0;a[t][n]=s}),Object.values(a).forEach(e=>{e.total=(e.Mall||0)+(e.Shophouse||0)+(e.NhaPho||0)+(e.DaDongCua||0)+(e.Khac||0)}),Object.values(a).sort((e,a)=>e.date.localeCompare(a.date))},[ed]),aH=n.useMemo(()=>{if(!ew)return[];let e=Array.isArray(ew)?ew:[],a=es.split("T")[0],r=el.split("T")[0],t=e.filter(e=>{let t=e.date;return t>=a&&t<=r}),n={};return t.forEach(e=>{let a=e.date;n[a]||(n[a]={date:a,KHTraiNghiem:0,KHIron:0,KHSilver:0,KHBronze:0,KHDiamond:0,Khac:0});let r=e.customerType;"KH trải nghiệm"===r&&(r="KHTraiNghiem"),"Kh\xe1ch h\xe0ng Iron"===r&&(r="KHIron"),"Kh\xe1ch h\xe0ng Silver"===r&&(r="KHSilver"),"Kh\xe1ch h\xe0ng Bronze"===r&&(r="KHBronze"),"Kh\xe1ch h\xe0ng Diamond"===r&&(r="KHDiamond"),(""===r||"Kh\xf4ng x\xe1c định"===r||"Kh\xe1c"===r)&&(r="Khac");let t=e.revenue||0;r&&r in n[a]&&(n[a][r]=t),("Kh\xf4ng x\xe1c định"===e.customerType||""===e.customerType||"Kh\xe1c"===e.customerType)&&console.log("Date: ".concat(a,', CustomerType: "').concat(e.customerType,'", Revenue: ').concat(t,", Mapped to: ").concat(r))}),Object.values(n).forEach(e=>{e.total=(e.KHTraiNghiem||0)+(e.KHIron||0)+(e.KHSilver||0)+(e.KHBronze||0)+(e.KHDiamond||0)+(e.Khac||0)}),Object.values(n).sort((e,a)=>e.date.localeCompare(a.date))},[ew,es,el]);return(0,t.jsxs)("div",{className:"p-2 sm:p-4 md:p-6 max-w-full",children:[(0,t.jsx)(S.E,{type:M.type,message:M.message,isVisible:M.isVisible,onClose:P}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"p-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsx)("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-900",children:"Order Report"}),(0,t.jsx)("button",{onClick:()=>{(0,T.e)(["orders-startDate","orders-endDate","orders-selectedBranches","orders-selectedRegions"]),B((0,s.Ec)((0,s.Xj)()).subtract({days:7})),I((0,s.Ec)((0,s.Xj)())),F([]),G([]),k("Đ\xe3 reset tất cả filter về mặc định!"),z()},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm",children:"Reset Filters"})]}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-10 bg-gray-200 rounded"})}),children:(0,t.jsx)(o,{startDate:L,setStartDate:B,endDate:Q,setEndDate:I,today:()=>(0,s.Ec)((0,s.Xj)()),parseDate:l._U,selectedRegions:_,setSelectedRegions:G,regionOptions:am,regionSearch:Y,setRegionSearch:Z,filteredRegionOptions:ap,showRegionDropdown:X,setShowRegionDropdown:q,regionDropdownRef:er,selectedBranches:U,setSelectedBranches:F,locationOptions:en,locationSearch:ee,setLocationSearch:ea,filteredLocationOptions:ag,showLocationDropdown:J,setShowLocationDropdown:$,locationDropdownRef:et})})]}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded"})}),children:(0,t.jsx)(c,{regionalSalesByDay:eY,formatAxisDate:aR})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded"})}),children:(0,t.jsx)(i,{storeTypeSalesByDay:aP,formatAxisDate:aR})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-32 bg-gray-200 rounded"})}),children:(0,t.jsx)(d,{totalWeekSales:null!=(e=null==eg?void 0:eg.totalRevenue)?e:0,weekSalesChange:null!=(a=null==eg?void 0:eg.revenueGrowth)?a:0,totalRevenueThisWeek:null!=(r=null==eg?void 0:eg.actualRevenue)?r:0,weekRevenueChange:null!=(D=null==eg?void 0:eg.actualGrowth)?D:0,foxieDebtChange:0})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded"})}),children:(0,t.jsx)(u,{regionStats:e1,totalRevenueThisWeek:(null==ey?void 0:ey.actualRevenue)||(Array.isArray(ev)?ev.reduce((e,a)=>e+a.revenue,0):0),totalPercentChange:e2,pieRegionRevenueData:af,isMobile:ak})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded"})}),children:(0,t.jsx)(h,{data:eY,isMobile:ak,formatAxisDate:aR},"regional-chart-".concat(es,"-").concat(el))}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded"})}),children:(0,t.jsx)(g,{data:aP,formatAxisDate:aR})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded"})}),children:(0,t.jsx)(m,{isMobile:ak,customerTypeSalesByDay:aH})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded"})}),children:(0,t.jsx)(p,{isMobile:ak,top10LocationChartData:av,fullStoreRevenueData:eP||void 0,formatMoneyShort:function(e){return e>=1e12?(e/1e12).toFixed(1)+"T":e>=1e9?(e/1e9).toFixed(1)+"B":e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toLocaleString()},totalRevenueThisWeek:ah.totalRevenueThisWeek,percentRevenue:ah.percentRevenue,retailThisWeek:ah.retailThisWeek,percentRetail:ah.percentRetail,productThisWeek:ah.productThisWeek,percentProduct:ah.percentProduct,cardThisWeek:ah.cardThisWeek,percentCard:ah.percentCard,foxieThisWeek:ah.foxieThisWeek,percentFoxie:ah.percentFoxie,avgRevenueThisWeek:ah.avgRevenueThisWeek,percentAvg:ah.percentAvg})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:[(0,t.jsx)("div",{className:"h-5 bg-gray-200 rounded w-1/4 mb-4"}),(0,t.jsx)("div",{className:"space-y-2",children:[1,2,3,4,5,6,7,8,9,10].map(e=>(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded"},e))})]}),children:(0,t.jsx)(v,{storeTableData:ab,avgRevenuePercent:aD,avgFoxiePercent:0,avgOrderPercent:aM})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded"})}),children:(0,t.jsx)(f,{isMobile:ak,ordersChartData:aS})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded"})}),children:(0,t.jsx)(b,{chartOrderData:aN,isMobile:ak})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-4 animate-pulse",children:[(0,t.jsx)("div",{className:"h-5 bg-gray-200 rounded w-1/4 mb-4"}),(0,t.jsx)("div",{className:"space-y-2",children:[1,2,3,4,5,6,7,8,9,10].map(e=>(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded"},e))})]}),children:(0,t.jsx)(x,{storeOrderTableData:aC,totalOrderSumAll:aO})}),(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-4",children:[1,2,3,4,5].map(e=>(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-4 animate-pulse",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/2"})]},e))}),children:(0,t.jsx)(y,{data:eB,loading:eQ,error:eI})})]})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[8262,8441,1684,7358],()=>a(82118)),_N_E=e.O()}]);